%\input{../../preamble}
%\begin{document}
\tikzset{
	% декорация линий
	curve line/.style={
		decoration={
			snake,
			amplitude=1.5mm,%0.75mm,
			segment length=7.5mm,
			post length=0mm,
			pre length=0mm,
		},
	},
}
% разделитель в многострочных формулах
%\newcommand\eqsep{\\[1em]}
% интеграл
\newcommand\intf[4][x]{ \int\limits_{#2}^{#3}{#4}\,\mathrm{d}#1 }
\newcommand\intfcenter[1]{ \intf{ x_{i-1/2} }{ x_{i+1/2} }{#1} }
\newcommand\intfleft[1]{ \intf{ x_{i-1/2} }{ x_{i} }{#1} }
\newcommand\intfright[1]{ \intf{ x_{i} }{ x_{i+1} }{#1} }
%\newcommand\intfCenter[1]{ \intf{ x_{i-\onehalf} }{ x_{i+\onehalf} }{#1} }
%\newcommand\intfCenter[1]{ \intf{ x_{i-1/2} }{ x_{i+1/2} }{#1} }
%\newcommand\intfright[1]{ \intf{ x_{i} }{ x_{i+1/2} }{#1} }


% СОДЕРЖАНИЕ+
%\renewcommand\contentsname{\begin{center}СОДЕРЖАНИЕ\end{center}}
%\tableofcontents

%
%	Краевые задачи для обыкновенных дифференциальных уравнений
%
\newpage
\section{Краевые задачи для обыкновенных дифференциальных уравнений}

Исследование большого круга естественно-научных и  
инженерных проблем приводит к математическим задачам, относящимся к 
решению дифференциальных уравнений и граничных проблем для них,
интегральных и других функциональных уравнений.

В практике чаще всего встречаются задачи, 
для которых точное решение не может быть найдено или оно имеет 
невысокую эффективность. 
Поэтому приближенные методы решения задач граничных задач, например,
задач математической физики, в особенности метод сеток 
получили широкое распространение.

Основные \emph{достоинства приближенных методов} заключаются в том, 
что они \emph{являются универсальными и эффективными},
так как позволяют находить приближенное решение для широкого класса задач 
новейших областей науки, техники и технологий.
Как правило, такие задачи формулируются в виде основного 
дифференциального уравнения (системы дифференциальный уравнений)
и дополнительных (граничных) условий, которые
обеспечивают существование и единственность решения.

\begin{tcolorbox}[colback=orange!10]
Под краевой (граничной) задачей понимают задачу о нахождении решения 
дифференциального уравнения (системы дифференциальных уравнений),
удовлетворяющего краевым условиям на границе рассматриваемой области.
\end{tcolorbox}

В каждой краевой задаче искомое решение должно 
удовлетворять дифференциальному в рассматриваемой области 
$\Omega$, а также некоторому дополнительному условию 
на границе $\partial\Omega$ или в нескольких различных точках этой
области. Например для одномерных задач, когда искомая функция 
зависит только от одной пространственной переменной 
$\vect{u}(x)$, краевые задачи можно сформулировать в виде:
\begin{gather}\label{eq:ODE_MAIN}
\diff{\vect{u}(x)}{x}=\vect{f}(x,\vect{u}),
\quad
\vect{\varphi}(\xi,\vect{u}(\xi))=0,
\quad
\xi\in\mathcal{A}
\end{gather}
где $\vect{u}(x)=(u_1,u_2,\ldots,u_n)^{\mathrm{T}}$ -- 
искомая неизвестная вектор-функция;
$x$ -- независимое переменное; 
$\vect{f}(x,\vect{u})=(f_1,f_2,\ldots,f_n)^{\mathrm{T}}$ -- 
вектор-функция многих переменных, определенная 
в некоторой замкнутой области изменения своих аргументов;
$\vect{\varphi}(\xi,\vect{u})=
(\varphi_1,\varphi_2,\ldots,\varphi_n)^{\mathrm{T}}$ -- 
вектор-функция многих переменных, определяющая 
дополнительные условия для неизвестной функции
в различных точках пространства;
$\mathcal{A}=\partial\Omega\cup\Omega$ --
множество точек на границе $\partial\Omega$ и/или
внутренних точках замкнутой области $\Omega$.

Однако, существуют задачи с более сложными по форме 
дополнительными условиями, например, условиями нормировки
стандартными для задач квантовой механики:
\begin{equation*}
\int\limits_{\mathcal{A}}
\norma{\vect{u}(\xi)}^2\,\mathrm{d}\xi=1,
\end{equation*}
где $\norma{\vect{u}(\xi)}$ -- норма, заданная в некотором
функциональном пространстве;\linebreak
$\mathcal{A}$ -- область интегрирования, которая в общем 
случае бесконечна $\mathcal{A}\to\infty$.

Формулировка корректно поставленных краевых задач 
возможна для систем дифференциальных уравнений, 
имеющих порядок не ниже второго.

Найти точное решение краевой задачи \eqref{eq:ODE_MAIN}
в элементарных функциях возможно в крайне узких классах
краевых задач, т.к. необходимо найти не только общее решение 
системы дифференциальных уравнений, но и 
явно определить из краевых условий значения 
входящих в общее решение постоянных коэффициентов.
Поэтому для численного решения краевых задач применяется 
метод стрельбы и разностный метод. 

Метод стрельбы основан 
на формулировке задачи Коши, которая эквивалентна 
краевой задачи \eqref{eq:ODE_MAIN}.
Необходимо отметить, что в отличие от задачи Коши, для 
которой при выполнении определенных условий 
гарантируется существование и единственность решения,
\emph{краевая задача} для того же дифференциального уравнения
\emph{может не иметь решения} или иметь несколько решений 
(в том числе и бесконечное множество решений). 

В разностном методе задача приближенно заменяется 
решением алгебраической системы уравнений, в которой
в качестве неизвестных выступают значения решения в узлах
пространственной сетки.

В случае нелинейных задач оба метода являются итерационными,
причем построение быстро сходящихся итерационных
процессов само является достаточно сложной задачей.

% **************************************
%
%	ВИДЫ КРАЕВЫХ ЗАДАЧ
%
\emptyline
\subsection{Линейные краевые условия}
Для систем дифференциальных уравнений специального вида
\begin{equation}\label{eq:ODE(BC):1D}
\left\{\begin{matrix}[rcl]
w^{\prime}(x)&=&f_1(x,u,w)\\
u^{\prime}(x)&=&f_2(x)\cdot w(x)
\end{matrix}\right.
\end{equation}
в зависимости от вида условий на границах
отрезка $0 \leqslant x \leqslant \ell$ (граница области поиска
решений $\partial\Omega$)
различают три основных типа граничных задач:
задачу Дирихле, Неймана и смешанную краевую задачу 
(таблица \ref{tab:ODE(BC)-type}).

%
% Основные виды краевых условий
%
\begin{table}[H]
\caption{Основные виды краевых условий
для системы обыкновенных дифференциальных уравнений 
\eqref{eq:ODE(BC):1D}
}
\label{tab:ODE(BC)-type}
\begin{tabular*}{\textwidth}{@{\extracolsep{\fill}}*4{l}}
\toprule
№&Краевое условие&Граница $x=0$&Граница $x=\ell$\\
\midmidrule
1&Дирихле
&$u(0)=u_0$
&$u(\ell)=u_1$\\
\addlinespace
2&Неймана
&$w(0)=w_0$
&$w(\ell)=w_1$\\
\addlinespace
3&Смешанная
&$a_0\cdot w(0)+b_0\cdot u(0)=c_0$
&$a_1\cdot w(\ell)+b_1\cdot u(\ell)=c_1$\\
\addlinespace
\bottomrule
\end{tabular*}
\end{table}

% *** Смешанная краевая задача ***
\begin{figure}[H]\centering
\begin{tikzpicture}
% контрольная область
\draw[
chamfered rectangle,
chamfered rectangle xsep=4pt,
chamfered rectangle angle=60,
minimum height=3em,
minimum width=10em
] (0,0) node[thick,color=black,draw,color=black,fill=lime!10,] (G)
{$a_0\cdot w(0)+b_0\cdot u(0)=c_0$};
\node[above] at (G.north) {Смешанная задача};
% Задача Дирихле
\draw[shape=rectangle,minimum height=3em, minimum width=5em]
($(G.south west)+(-3em,-5em)$)
node[thick,red,draw=red,fill=red!10] (D) {$u(0)=u_0\equiv\dfrac{c_0}{b_0}$};
\node[below] at (D.south) {Задача Дирихле};
% Задача Неймана
\draw[shape=rectangle, minimum height=3em, minimum width=5em]
($(G.south east)+(3em,-5em)$)
node[thick,blue,draw=blue,fill=blue!10] (N) {$w(0)=w_0\equiv\dfrac{c_0}{a_0}$};
\node[below] at (N.south) {Задача Неймана};
% стрелки
\draw[-latex,very thick,red] (G.west) -| (D.north) node[left,midway] {$a_0\equiv0$};
\draw[-latex,very thick,blue] (G.east) -| (N.north) node[right,midway] {$b_0\equiv0$};
\end{tikzpicture}
% *******************************************
\caption{Виды краевых задач для систем обыкновенных
дифференциальных уравнений вида \eqref{eq:ODE(BC):1D}}
\label{fig:ODE_BC(Genaral)}
\end{figure}

С формальной точки зрения, задача Дирихле и Неймана являются
частными случаями смешанной краевой задачи 
(рисунок \ref{fig:ODE_BC(Genaral)}):
например, если $a_0\equiv0$, то смешанная краевая задача
трансформируется в задачу Дирихле:
\begin{gather*}
0\cdot w(0)+b_0\cdot u(0)=c_0,
\quad\Rightarrow\quad 
u(0) = \dfrac{c_0}{b_0} = u_0,
\end{gather*}
а если полагать $b_0\equiv0$, то формулируется задача Неймана:
\begin{gather*}
a_0\cdot w(0)+0\cdot u(0)=c_0,
\quad\Rightarrow\quad 
w(0)=\dfrac{c_0}{a_0}=w_0.
\end{gather*}

Поэтому для общности, можно рассматривать только 
смешанную краевую задачу стандартного вида:
\begin{equation}\label{eq:ODE+BC:1D}
\left\{\begin{matrix}[rcl]
w^{\prime}(x)&=&f_1(x,u,w)\\
u^{\prime}(x)&=&f_2(x)\cdot w(x)\\
a_0\cdot w(0)&+&b_0\cdot u(0) = c_0\\
a_1\cdot w(\ell)&+&b_1\cdot u(\ell) = c_1
\end{matrix}\right.,
\end{equation}
где $f_1(x,u,w)$ и $f_2(x)$ -- известные функции, в том числе может
быть разрывные;
$a_{0,1}$, $b_{0,1}$ и $c_{0,1}$ -- известные постоянные
коэффициенты, определяемые физическим смыслом 
решаемой задачи.

% **************************************************
%
%	Краевые условия для обыкновенных дифференциальных уравнений
%
% **************************************************
%\begin{figure}[H]\centering
%\begin{subfigure}[b]{.5\linewidth}\centering
%\begin{tikzpicture}
%%
%%	Задача Дирихле
%%
%\begin{axis}[width=8cm,
%name=plota,
%xlabel = {$x$},		% подпись оси x
%ylabel = {$y(x)$},	% подпись оси y
%xmin=-1, xmax=4, xtick={0,3}, xticklabels={$a$,$b$},
%ymin=0, ymax=9, ytick={3,6}, yticklabels={\empty},
%]
%\addplot[thick,black,domain=0:3,samples=50] {x^2-2*x+3};
%\addplot[
%only marks,mark=*,mark size=3pt, mark options={fill=white,draw=red,thick},
%nodes near coords,point meta=explicit symbolic,
%node near coord style={above,yshift=0.5ex,color=red}%fill=olive!10},
%] coordinates {(0,3) [$y_a$] (3,6) [$y_b$]};
%\end{axis}
%\end{tikzpicture}
%\caption{задача Дирихле}
%\end{subfigure}%
%%
%%	Задача Неймана
%%
%\begin{subfigure}[b]{.5\linewidth}\centering
%\begin{tikzpicture}
%\begin{axis}[width=8cm,
%name=plotb, at={($(plota.east)+(3cm,0)$)}, anchor=west,
%xlabel = {$x$},		% подпись оси x
%ylabel = {$y(x)$},	% подпись оси y
%xmin=-1, xmax=4, xtick={0,3}, xticklabels={$a$,$b$},
%ymin=0, ymax=9, ytick={\empty}, %yticklabels={$y_a$,$y_b$},
%]
%\addplot[thick,black,domain=0:3,samples=50] {x^2-2*x+3};
%\addplot[
%only marks,mark=*,mark size=3pt,mark options={fill=white,draw=red,thick},
%nodes near coords,	 point meta=explicit symbolic,
%node near coord style={above,yshift=1ex,color=red}
%] coordinates {(0,3) [$y^{\prime}_a$] (3,6) [$y^{\prime}_b$]};
%% y'(a)
%\addplot[thick,red,domain=-0.75:0.75,samples=2] {-2*x+3};
%% y'(b)
%\addplot[thick,red,domain=2.5:3.5,samples=2] {4*x-6};
%\end{axis}
%\end{tikzpicture}
%\caption{задача Неймана}
%\end{subfigure}
%\caption{ Графическая иллюстрация постановки краевых задач\\
%a) -- Дирихле; b) -- Неймана}
%\end{figure}

%
%	Построение разностных схем методом баланса
%
\emptyline
\subsection{Построение разностных схем методом баланса}
Различные физические процессы (теплопроводности или диффузии,
колебаний, газодинамики и т. д.) характеризуются некоторыми 
интегральными законами сохранения (тепла, массы, количества движения, энергии и т. д.).
При выводе дифференциальных уравнений различных математических моделей
объектов или явлений отталкиваются от некоторого интегрального 
соотношения (уравнения баланса), выражающего закон сохранения для малого объема.
Дифференциальное уравнение получается из уравнения баланса 
при стягивании рассматриваемого объема к нулю 
в предположении существования непрерывных производных, 
входящих в уравнение.

Метод конечных разностей физически означает переход от непрерывной среды
к некоторой ее дискретной модели. При таком переходе естественно требовать, 
чтобы основные свойства физического процесса сохранялись, т.е.
выполнялись законы сохранения различных физичеких субстанций
(количестово тепла, массы, заряда, импульса и т.д.).

Численные методы решения краевых задач основаны 
на замене дифференциальной задачи \eqref{eq:ODE+BC:1D}
системой линейных алгебраических уравнений, т.е. разностной схемой.

\alert{Разностная схема} -- совокупность разностных алгебраических уравнений, 
аппроксимирующих систему дифференциальных уравнений
и дополнительные (граничные) условия исходной задачи.
Разностные схемы, выражающие на сетке законы сохранения физических субстанций, 
называют консервативными (или дивергентными). 
Законы сохранения для всей сеточной области (``интегральные законы сохранения``)
для консервативных схем должны быть алгебраическим следствием разностных уравнений.

Для получения консервативных разностных схем естественно исходить из уравнений баланса,
записанных для элементарных объемов (ячеек) сеточной области.
Входящие в эти уравнения баланса интегралы и производные следует заменить 
приближенными разностными выражениями.
В результате получаем однородную разностную схему.
Такой метод получения консервативных однородных разностных схем 
называется интегро-интерполяционным методом (методом баланса).

%
%	ФИЗИЧЕСКАЯ ИНТЕРПРЕТАЦИЯ КРАЕВЫХ ЗАДАЧ
%
\emptyline
\subsubsection{Физическая интерпретация краевых задач}
Уравнение \eqref{eq:ODE+BC:1D} можно интерпретировать 
как уравнение установившегося распределения температуры 
$u(x)$ в стержне длины $\ell$.
В такой постановке краевую задачу можно записать в виде:
\begin{gather}\label{eq:HT+BC:1D}
\left\{\begin{matrix}[rcrcl]
w^{\prime}(x)&+&r(x)\cdot u(x)&=&q(x)\\
w(0)&+&r_0\cdot u(0)&=&\mathring{u}_0\\
-w(\ell)&+&r_1\cdot u(\ell)&=&\mathring{u}_1
\end{matrix}\right.,
\end{gather}

где
$w(x)$ -- тепловой поток, величина которого в соответствие с 
\href{https://en.wikipedia.org/wiki/Thermal_conductivity}
{законом теплопроводности Фурье} пропорциональна 
градиенту температуры: % закон теплопроводности Фурье
\begin{gather}\label{eq:FourierLaw}
w(x)=-k(x)\cdot u^{\prime}(x)
;\end{gather}
$k(x)$ -- коэффициент температуропроводности материала стержня;
$r(x)\cdot u(x)$ -- мощность распределенных стоков ($r>0$)
или источников ($r<0$) тепла вдоль боковой поверхности стержня;
$r(x)$ -- коэффициент конвекционного теплообмена боковой поверхности
стержня с окружающей средой;
$q(x)$ -- мощность внутренних распределенных источников ($q>0$)
или стоков ($q<0$) тепла в стержне.

Граничные условия \eqref{eq:HT+BC:1D} определяют 
процесс теплообмена концов стержня $x=\{0,\ell\}$
с окружающей средой по закону
% закон конвекционного теплообмена Ньютона
\href{https://en.wikipedia.org/wiki/Newton\%27s_law_of_cooling}
{конвекционного теплообмена Ньютона} -- 
``Тепловой поток тепла $\mathring{w}$ через поверхность материального 
тела в окружающую среду прямо пропорционален разнице 
температур между поверхностью тела и окружающей средой``:
\begin{gather*}
\mathring{w}=r\cdot(u - \mathring{u}),
\end{gather*}
где 
$r$ --  коэффициент конвективного теплообмена;
$u$ -- температура поверхности тела;
$\mathring{u}$ -- температура окружающей среды.

Процессы выделения или поглощения тепла 
в твердом теле могут быть связаны с рядом явлений:
\begin{enumerate}
\item
выделение тепла ($q(x)>0$) при пропускании 
электрического тока через стержень (закон Джоуля-Ленца),
вследствие протекания в объеме стержня
каких-либо экзотермических химических реакций;
\item
поглощение тепла ($q(x)<0$) за счет 
термоэлектрических явлений (например, эффект Пельтье), а также
вследствие протекания эндотермических химических реакций
в объеме материала стержня.
\end{enumerate}

Необходимо отметить, что в зависимости от физического смысла 
постановки краевых задач коэффициенты 
дифференциального уравнения задачи \eqref{eq:HT+BC:1D}
могут быть и разрывными функциями.
Можно выделить несколько практически важных случаев:
\begin{enumerate}
\item
\emph{однородный стержень} с локальной теплоизоляцией,
т.е. конвекционный теплообмен участка $x\in[a,b]$
боковой поверхности стрежня с окружающей средой
затруднен или отсутствует (рисунок \ref{fig:BC:homo material:r(x)}):
\begin{gather*}
r(x)=\begin{cases}
r_1,& 0 \leqslant x < a\\
r_2,& a \leqslant x \leqslant b\\
r_1,& b < x \leqslant \ell
\end{cases},
\end{gather*}
где $[a,b]$ -- теплоизолированный участок однородного стержня;

\item
\textit{однородный стержень} с локальным нагревом, т.е.
на участке стержня $[a,b]$ происходит нагрев стержня 
за счет внешних источников тепловой энергии
(рисунок \ref{fig:BC:homo material:q(x)}), например, 
излучения:
\begin{gather*}
q(x)=\begin{cases}
0,& 0 \leqslant x < a\\
q_1,& a \leqslant x \leqslant b\\
0,& b < x \leqslant \ell
\end{cases},
\end{gather*}
где $[a,b]$ -- участок локального нагрева стержня 
внешними источниками тепловой энергии;

\pgfplotsset{
gap axis style/.append style={
	width=7cm,% размер графиков
	font=\small,% размер шрифта
	xlabel=$x$,xmin=-10,xmax=110,
	ylabel=\empty,ymin=0,ymax=100,
	grid=none,% сетка
},
}
\tikzset{
	o-point/.style={
		color=darkred,thick,fill=white,
	},
}
\begin{figure}[H]\centering
%
% первый график
%
\begin{subfigure}[b]{.5\linewidth}\centering
\begin{tikzpicture}
\begin{axis}[gap axis style,ylabel=$r(x)$,
xtick=data,xticklabels={$0$,$a$,$b$,$\ell$},
ytick=data,yticklabels={$r_1$,$r_2$}]
%\begin{scope}[color=darkred,>={Straight Barb[angle=45:2mm 1]},shorten >=1pt]
\addplot[mark=none,darkblue,thick,
shading=axis,top color=blue!50,bottom color=blue!5]
coordinates{(0,80)(35,80)(35,20)(70,20)(70,80)(100,80)}\closedcycle;
%\end{scope}
\end{axis}
\end{tikzpicture}
\caption{теплоизолированный участок}
\label{fig:BC:homo material:r(x)}
\end{subfigure}%
%
% второй график
%
\begin{subfigure}[b]{.5\linewidth}\centering
\begin{tikzpicture}
\begin{axis}[gap axis style,ylabel=$q(x)$,
xtick=data,xticklabels={$0$,$a$,$b$,$\ell$},
ymin=-10,ytick=data,yticklabels={$0$,$q_1$}]
%\begin{scope}[color=darkred,>={Straight Barb[angle=45:2mm 1]},shorten >=1pt]
\addplot[mark=none,darkred,thick,
shading=axis,top color=red!50,bottom color=red!5]
coordinates{(0,0)(35,0)(35,80)(70,80)(70,0)(100,0)}\closedcycle;
%\end{scope}
\end{axis}
\end{tikzpicture}
\caption{локальный нагрев}
\label{fig:BC:homo material:q(x)}
\end{subfigure}
\caption{Однородный образец}\label{fig:BC:variants}
\end{figure}

\item
\emph{неоднородный стержень}, состоящий из нескольких
разнородных материалов, которые отличаются коэффициентами 
температуропроводности $k_1\ne k_2$ и
конвекционного теплообмена $r_1\ne r_2$
(рисунок ):
\begin{gather*}
k(x)=\begin{cases}
k_1,& 0\leqslant x \leqslant c\\
k_2,& c< x \leqslant \ell
\end{cases}
,\quad
r(x)=\begin{cases}
r_1,& 0\leqslant x \leqslant c\\
r_2,& c< x \leqslant \ell
\end{cases},
\end{gather*}
где $c$ -- точка контакта двух различных материалов;
$[0,c]$ и $(c,\ell]$ -- участки стержня, состоящие из 
разных материалов с различными коэффициентами 
температуропроводности $k_1\ne k_2$ и
конвекционного теплообмена $r_1\ne r_2$;

\begin{figure}[H]\centering
%
% первый график
%
\begin{subfigure}[b]{.5\linewidth}\centering
\begin{tikzpicture}
\begin{axis}[gap axis style,ylabel=$k(x)$,
xtick=data,xticklabels={$0$,$c$,$\ell$},
ytick=data,yticklabels={$k_1$,$k_2$}]
\begin{scope}[>={Straight Barb[angle=45:2mm 1]},shorten >=1pt]
% разрыв функции
\addplot[mark=none,thick,shading=axis,
left color=teal!5,right color=teal!50,on layer=background]
coordinates{(0,30)(30,30)(30,80)(100,80)}\closedcycle;
\end{scope}
\end{axis}
\end{tikzpicture}
\caption{теплопроводность}
\label{fig:BC:hetero material:k(x)}
\end{subfigure}%
%
% второй график
%
\begin{subfigure}[b]{.5\linewidth}\centering
\begin{tikzpicture}
\begin{axis}[gap axis style,ylabel=$r(x)$,
xtick=data,xticklabels={$0$,$c$,$\ell$},
ytick=data,yticklabels={$r_1$,$r_2$}]
\begin{scope}[>={Straight Barb[angle=45:2mm 1]},shorten >=1pt]
% разрыв функции
\addplot[mark=none,darkblue,thick,shading=axis,
left color=blue!50,right color=blue!5,on layer=background]
coordinates{(0,50)(30,50)(30,20)(100,20)}\closedcycle;
\end{scope}
\end{axis}
\end{tikzpicture}
\caption{конвекционный теплообмен}
\label{fig:BC:hetero material:r(x)}
\end{subfigure}
\caption{Неоднородный образец}\label{fig:BC:hetero material}
\end{figure}

\item
\emph{неоднородный стержень}, с локальной теплоизоляцией,
т.е. конвекционный теплообмен на участке
боковой поверхности стрежня $[a,b]$ с окружающей средой 
затруднен или отсутствует (рисунок): 
\begin{gather*}
k(x)=\begin{cases}
k_1,\quad 0\leqslant x \leqslant c\\
k_2,\quad c< x \leqslant \ell
\end{cases}
,\quad
r(x)=\begin{cases}
r_1,\quad 0 \leqslant x \leqslant a\\
r_2,\quad a < x \leqslant b\\
r_3,\quad b < x \leqslant \ell
\end{cases}
,\end{gather*}
где $[a,b]$ -- теплоизолированный участок неоднородного стержня ($r\equiv0$).

\begin{figure}[H]\centering
%
% первый график
%
\begin{subfigure}[b]{.5\linewidth}\centering
\begin{tikzpicture}
\begin{axis}[gap axis style,ylabel=$k(x)$,
xtick=data,xticklabels={$0$,$c$,$\ell$},
ytick=data,yticklabels={$k_1$,$k_2$}]
\begin{scope}[>={Straight Barb[angle=45:2mm 1]},shorten >=1pt]
% разрыв функции
\addplot[mark=none,thick,shading=axis,
left color=teal!5,right color=teal!50,on layer=background]
coordinates{(0,30)(30,30)(30,80)(100,80)}\closedcycle;
\end{scope}
\end{axis}
\end{tikzpicture}
\caption{теплопроводность}
\label{fig:BC:hetero2 material:k(x)}
\end{subfigure}%
%
% второй график
%
\begin{subfigure}[b]{.5\linewidth}\centering
\begin{tikzpicture}
\begin{axis}[gap axis style,ylabel=$r(x)$,
xtick=data,xticklabels={$0$,$c$,$a$,$b$,$\ell$},
ytick=data,yticklabels={$r_1$,$r_2$}]
% разрыв функции
\addplot[mark=none,darkblue,thick,shading=axis,shading angle=-45,
left color=blue!50,right color=blue!5,on layer=background]
coordinates{(0,90)(30,90)(30,50)(55,50)(55,20)(80,20)(80,50)(100,50)}\closedcycle;
\end{axis}
\end{tikzpicture}
\caption{конвекционный теплообмен}
\label{fig:BC:hetero2 material:r(x)}
\end{subfigure}
\caption{Неоднородный образец
с локальной теплоизоляцией}\label{fig:BC:hetero2 material}
\end{figure}

\end{enumerate}

%
%	РАСЧЕТНАЯ СЕТКА
%
\subsubsection{Расчётная сетка}
При численном решении той или иной математической задачи 
невозможно получить решение для всех значений аргумента, 
изменяющегося внутри некоторой области евклидова 
пространства.
Поэтому в этой области выбирается некоторое 
конечное множество точек и отыскивается приближенное решение 
только в этих точках. Такое множество точек называется сеткой,
а отдельные точки -- узлами сетки. 
Необходимо отметить, что свойства разностного решения задачи 
и, в частности, его близость к точному решению зависят 
от выбора сетки. 

Процедуру построения расчетной сетки можно рассматривать 
как построение взаимно-однозначного отображения 
области определения функции (физической области) 
на некоторую расчетную область более простой формы.

Для перехода от дифференциальной краевой задачи
\eqref{eq:HT+BC:1D} 
к системе алгебраических уравнений воспользуемся 
\emph{разностным методом}.
Для этого на отрезке $[0,\ell]$ введем произвольную 
неравномерную сетку -- конечное упорядоченное 
множество точек $\{x_i\}$, принадлежащих этому отрезку
(рисунок \ref{fig:ODE+BC:mesh}):
\begin{gather*}
0=x_0<x_1<x_2<\cdots<x_i<\cdots<x_{n-1}<x_n=\ell,
\end{gather*}
где $x_i\in[0,\ell]$ -- узлы сетки;
$i=0,1,2\dots,n$ -- порядковый номер узла сетки;
$n$ -- количество узлов сетки.

\begin{figure}[H]\centering
\begin{tikzpicture}
[>={Straight Barb[angle=45:2mm 1]},shorten >=1pt]% стрелка
% начало отсчета
\coordinate (O) at (0mm,0mm);
% ось OX
\draw[->,line width=0.25mm] (O)% node[pos=0,yshift=-1em]{$0$}
-- +(130mm,0mm) node[pos=1,yshift=-1em]{$x$};
% сетка
\coordinate (p) at (O);
\foreach \x [count=\n from 0] in {0,17,12,15,19,16,14,17}{
%\draw[line width=0.25mm] (p) -- ++(\x mm,0mm) coordinate(p)
%-- +(0mm,1.5mm) -- +(0mm,-1.5mm) coordinate(p\n);}
\path (p) -- ++(\x mm,0mm) coordinate(p);
\draw[fill=black] (p) circle[radius=0.8mm] coordinate(p\n);
}
% подписи
\draw (p0) node[yshift=-2ex]{$0$};
\foreach \n in {0,1,2}{ \draw (p\n) node[yshift=1em]{$x_\n$}; }
\draw (p4) node[yshift=1em]{$x_i$};
\draw (p6) node[yshift=1em]{$x_{n-1}$};
\draw (p7) node[yshift=1em]{$x_n$} node[yshift=-2ex]{$\ell$};
% штриховка
\path (p0) -- +(0mm,1mm) coordinate(x0);
\path (p7) -- +(0mm,1mm) coordinate(x7);
\begin{scope}[on background layer]
\pattern[pattern=north east lines,pattern color=gray,opacity=0.5]
%([yshift=1mm]p0) -- ([yshift=-2mm]p0) -- 
%([yshift=-2mm]p7) -- ([yshift=1mm]p7)  -- cycle;
(p0) -- ([yshift=-2mm]p0) -- ([yshift=-2mm]p7) -- (p7) -- cycle;
\end{scope}
\end{tikzpicture}
\caption{Схематическое изображение расположения узлов $x_i$
\linebreak расчетной сетки $\{x_0,x_1,\ldots,x_n\}$}
\label{fig:ODE+BC:mesh}
\end{figure}

\begin{tcolorbox}
Если заданы коэффициенты системы дифференциальных уравнений
\eqref{eq:HT+BC:1D} и \emph{известны их точки разрывов}, 
то всегда можно выбрать неравномерную сетку так, 
чтобы точки разрыва коэффициентов $\vect{f}(x)=\{k(x), r(x), q(x)\}$ 
совпадали с узлами расчетной сетки 
(рисунок \ref{fig:ODE+BC:gap-function}).
\end{tcolorbox}

%
% разрыв коэффициентов
%
\begin{figure}[H]\centering
\begin{tikzpicture}
\begin{axis}[xlabel=\empty,
xmin=10,xmax=100,ymin=10,ymax=90,
xtick={20,50,90},xticklabels={$x_{i-1}$,$x_i$,$x_{i+1}$},
ytick={30,70},yticklabels={$f_1$,$f_2$}]
% заполнение
\addplot[draw=none,thick,fill=darkgreen!7,on layer=background]
coordinates{(20,0)(20,30)(50,30)(50,70)(90,70)(90,0)}\closedcycle;
% линии и стрелки
\begin{scope}[>={Straight Barb[angle=45:1.5mm 1]},shorten >=1pt,shorten <=1pt]
\addplot[->,draw=darkgreen,thick]coordinates{(20,30)(50,30)};
\addplot[<-,draw=darkgreen,thick]coordinates{(50,70)(90,70)};
\path (axis cs:50,30) -- (axis cs:50,70)
node[midway,sloped,above,fill=white]{$f_1\ne f_2$}
node[midway,sloped,below,color=darkgreen]{разрыв};
\end{scope}
% маркеры
\addplot[ball darkgreen,thick,only marks]coordinates{(20,30)(90,70)};
\end{axis}
\end{tikzpicture}
\caption{График функции $f(x)$, которая имеет разрыв в точке $x=x_i$}
\label{fig:ODE+BC:gap-function}
\end{figure}

Например, рассмотрим нагревательную систему, 
состоящую из разнородных металлов, локальная область
которой тепло изолирована. Известные геометрические размеры
и взаимное положение всех частей системы.
Нагрев этой системы осуществляется
с помощью пропускания постоянного электрического тока,
который вызывает выделения джоулева тепла в объеме металлов.

Начало отсчета $\mathcal{O}$ пространственной координаты $x$
можно выбрать на одном из концов первого проводника, 
ось координат $\mathcal{O}x$ -- в направлении 
места контакта двух проводников.

Так как системы состоит из разнородных металлических 
проводников, то коэффициент теплопроводности $k$ и 
удельная мощность внутренних источников тепла $q$
терпят разрыв в точке контакта этих проводников:
\begin{gather*}
k(x)=\begin{cases}
k_1,& 0\leqslant x \leqslant \ell_1\\
k_2,& \ell_1 < x \leqslant L
\end{cases},
\qquad
q(x)=\begin{cases}
q_1,& 0\leqslant x \leqslant \ell_1\\
q_2,& \ell_1 < x \leqslant L
\end{cases},
\end{gather*}
где $k_1$ и $k_2$, $q_1$ и $q_2$, $\ell_1$ и $\ell_2$ --
коэффициенты теплопроводности, 
удельная мощность внутренних источников тепла, 
длина первого и второго металлического проводника,
соответственно;
$L=\ell_1+\ell_2$ -- общая длина нагревательной системы.

Если теплообмен металлических проводников с окружающей средой 
осуществляется за счет свободной конвекции, то локальная 
тепловая изоляция нагревательной системы означает отсутствие
конвекционного теплового потока на локальном участке,
т.е. коэффициент теплообмена имеет разрывы:
\begin{gather*}
r(x)=\begin{cases}
0,& 0\leqslant x \leqslant \lambda_1\\
r,& \lambda_1 < x \leqslant \lambda_2\\
0,& \lambda_2 < x \leqslant L\\
\end{cases},
\end{gather*}
где $\lambda_1$ и $\lambda_1$ -- начальное и конечное
положение области тепловой изоляции.

Построим равномерную сетки в рассматриваемой 
пространственной области $0\leqslant x \leqslant L$,
задав произвольное количество интервалов $n$:
\begin{equation}
\{x_0=0, x_1=x_0+h, \ldots, x_{i+1} = x_i + h, \ldots,x_n=L\},
\end{equation}
 где $h$ -- шаг сетки
 
Алгоритм построения квазиравномерной пространственной сетки,
согласованной с точками разрыва коэффициентов $\vect{f}(x)$
краевой задачи:
\begin{enumerate}
\item
Определяются границы всех областей однородности, 
в которых коэффициенты краевой задачи непрерывны:

\end{enumerate}

Выделим на отрезке $[0,\ell]$ подмножество промежуточных 
узлов $\{x_{i\pm1/2}\}$ (рисунок \ref{fig:ODE+BC:mesh:main+secound}):
\begin{gather*}
x_{i\pm1/2}=\dfrac{x_i+x_{i\pm1}}{2},\quad i=1,2,\ldots,n-1
,\end{gather*}
где $x_{i\pm1/2}$ -- середины отрезков 
$[x_{i-1}, x_i]$ и $[x_i, x_{i+1}]$, соответственно.

% Промежуточная сетка
\begin{figure}[H]\centering
\begin{tikzpicture}
[>={Straight Barb[angle=45:2mm 1]},shorten >=1pt]% стрелка
% начало отсчета
\coordinate (O) at (0mm,0mm);
% ось OX
\draw[->,line width=0.25mm] (O)% node[pos=0,yshift=-1em]{$0$}
-- +(120mm,0mm) node[pos=1,yshift=-1em]{$x$};
% основная сетка
\coordinate (p) at (O);
\foreach \x [count=\n from 0] in {19,36,42}{
\path (p) -- ++(\x mm,0mm) coordinate(p);
\draw[fill=black] (p) circle[radius=0.8mm] coordinate(p\n);
}
% подписи
\draw (p0) node[yshift=1em]{$x_{i-1}$};
\draw (p1) node[yshift=1em]{$x_i$};
\draw (p2) node[yshift=1em]{$x_{i+1}$};
% промежуточная сетка
\coordinate (p) at (O);
\foreach \x [count=\n from 0] in {37,39}{
\path (p) -- ++(\x mm,0mm) coordinate(p);
\draw[line width=0.25mm,fill=white] (p) circle[radius=0.8mm] coordinate(p\n);
}
% подписи
\draw (p0) node[yshift=-1em]{$x_{i-1/2}$};
\draw (p1) node[yshift=-1em]{$x_{i+1/2}$};
\end{tikzpicture}
\caption{Схематическое изображение расположения узлов 
основной и промежуточной расчетной сеток}
\label{fig:ODE+BC:mesh:main+secound}
\end{figure}

Расстояние между соседними узлами расчётной сетки 
$h_i$ (шаг сетки), как и расстояние между соседними 
промежуточными узлами, 
$h_{i+1/2}$ (шаг промежуточной сетки) 
зависят от номера узла $i$ сетки:
\begin{gather*}
\begin{array}{rcl}
h_i&=&x_i-x_{i-1},\\
h_{i+1/2}&=&x_{i+1/2}-x_{i-1/2}=\dfrac{h_{i+1}+h_i}{2}.
\end{array}
\end{gather*}

Значения неизвестной функции $u(x)$ (температуры) 
рассмотрим в узлах сетки $\{x_i\}$, 
а потоковую величину $w(x)$ (тепловой поток) -- 
в промежуточных узлах $\{x_{i\pm1/2}\}$ 
(рисунок \ref{fig:ODE+BC:u(x) and w(x)}).

%
% Температура и тепловой поток
%
\pgfplotsset{
uxwx axis style/.append style={
	font=\small,% размер шрифта
	xlabel=\empty,xmin=-10,xmax=110,
	xtick={0,20,40,70,100},
	xticklabels={$x_{i-1}$,$x_{i-1/2}$,$x_i$,$x_{i+1/2}$,$x_{i+1}$},
	ylabel=\empty,
%	grid=none,% сетка
},
}
\begin{figure}[H]\centering
%
% первый график
%
\begin{tikzpicture}
% левая ось OY
\begin{axis}[uxwx axis style,
axis y line*=left,
ymin=0,ymax=100,ytick={10,60},
yticklabels={$w_{i-1/2}$,$w_{i+1/2}$}]
% заполнение
\addplot[draw=none,fill=darkred!7,on layer=background] 
coordinates{(0,0)(0,10)(40,10)(40,60)(100,60)(100,0)}\closedcycle;
\addplot[draw=none,fill=blue!14,opacity=0.25,on layer=background]
coordinates{(0,80)(20,80)(20,30)(40,30)(70,30)(70,50)(100,50)}\closedcycle;
% линии
\addplot[draw=darkred,thick] 
coordinates{(0,10)(40,10)(40,60)(100,60)};
\addplot[draw=darkblue]
coordinates{(0,80)(20,80)(20,30)(40,30)(70,30)(70,50)(100,50)};
% маркеры
\addplot[ball darkred,only marks] coordinates{(20,10)(70,60)};
\addplot[ball darkblue,only marks] coordinates{(0,80)(40,30)(100,50)};
\end{axis}
% правая ось OY
\begin{axis}[uxwx axis style,
axis y line*=right,axis x line=none,ymajorgrids,
ymin=0,ymax=100,ytick={80,30,50},
yticklabels={$u_{i-1}$,$u_i$,$u_{i+1}$}]
\end{axis}
\end{tikzpicture}
\caption{
Схематическое изображение распределения неизвестной
функции $u(x)$ и потоковой величины $w(x)$
в пределах контрольной области $[x_{i-1},x_{i+1}]$}
\label{fig:ODE+BC:u(x) and w(x)}
\end{figure}

%
%	Разностная схема для дифференциального уравнения
%
\subsubsection{Разностная схема для дифференциального уравнения}
Для построения разностной схемы для краевой задачи 
воспользуемся\linebreak интегро-интерполяционным методом 
(или \emph{методом баланса}) построения разностных схем.
Проинтегрируем \emph{дифференциальное уравнение} 
\eqref{eq:HT+BC:1D} в пределах контрольной области 
$[x_{i-1/2},x_{i+1/2}]$:
\begin{gather*}
\intfcenter{w^{\prime}(x)}+\intfcenter{r(x)\cdot u(x)}=\intfcenter{q(x)}
\end{gather*}

Тогда уравнение теплового баланса для контрольной области 
запишется в виде:
\begin{gather}\label{eq:ODE+BC:heat balance}
w(x_{i+1/2})-w(x_{i-1/2})+\intfcenter{r(x)\cdot u(x)}=\intfcenter{q(x)}
%w(x_{i+\onehalf})-w(x_{i-\onehalf})+\intfCenter{r(x)\cdot u(x)}=\intfCenter{g(x)}
\end{gather}

На рисунке \ref{fig:ODE+BC:heat_balance} представлена 
графическая иллюстрация процессов переноса тепла, теплообмена
и тепловыделения (теплопоглощения) для контрольной области
$[x_{i-1/2},x_{i+1/2}]$.

% *** Баланс тепла ***
\begin{figure}[H]\centering
\begin{tikzpicture}
% контрольная область
\draw[shape=rectangle, minimum height=2.5cm, minimum width=4.5cm] 
(0,0) node[thick,color=black,draw,color=black,fill=orange!10,] (A)
{$\intfcenter{q(x)}$};
% слагаемые уравнения баланса
\begin{scope}[ultra thick]
\draw[-to,darkred] (A.east) -- +(3,0) node[above,midway] {$w(x_{i+1/2})$};
\draw[to-,darkred] (A.west) -- +(-3,0) node[above,midway] {$w(x_{i-1/2})$};
\draw[-to,curve line,darkblue,decorate] (A.north) -- +(0,3) 
node[right,midway,xshift=1ex] {$\intfcenter{r(x)\cdot u(x)}$};
\end{scope}
% ось OX
\draw[very thick,black] ($(A.south west)+(-4,-1em)$) -- ($(A.south west) + (0,-1em)$);
\draw[ultra thick,orange] ($(A.south west)+(0,-1em)$) -- ($(A.south east) + (0,-1em)$);
\draw[-{Straight Barb[angle=45:2mm 1]},very thick,black] ($(A.south east)+(0,-1em)$) -- ($(A.south east) + (4,-1em)$) node[below,yshift=-1ex] {$x$};
% границы отрезка (относительно границ прямоугольника)
\draw[very thick,black] ($(A.south west)+(0,-0.75em)$) -- ($(A.south west) + (0,-1.25em)$) node[below] {$x_{i-1/2}$};
\draw[ultra thick,orange] ($(A.south)+(0,-0.75em)$) -- ($(A.south) + (0,-1.25em)$) node[below,black] {$x_{i}$};
\draw[very thick,black] ($(A.south east)+(0,-0.75em)$) -- ($(A.south east) + (0,-1.25em)$) node[below] {$x_{i+1/2}$};
\end{tikzpicture}
\caption{Иллюстрация баланса тепла \eqref{eq:ODE+BC:heat balance}
для контрольной области $[x_{i-1/2},x_{i+1/2}]$}
\label{fig:ODE+BC:heat_balance}
\end{figure}

 
Рассмотрим физический смысл каждого члена
уравнения теплового баланса \eqref{eq:ODE+BC:heat balance}:
\begin{enumerate}
\item
первое слагаемое $w(x_{i-1/2})$ определяет количество тепла, 
``втекающего`` через сечение $x=x_{i-1/2}$;
\item
второе слагаемое $w(x_{i+1/2})$ это количество 
``вытекающего`` тепла через сечение $x=x_{i+1/2}$;
\item
третье слагаемое в левой части представляет собой количество тепла, 
отдаваемое стержнем внешней среде за счет конвекционного теплообмена 
на его боковой поверхности;
\item
правая честь \eqref{eq:ODE+BC:heat balance} соответствует 
количеству тепла, выделяющегося на отрезке 
$[x_{i-1/2},x_{i+1/2}]$ за счет распределенных 
источников тепла с плотностью $q(x)$.
\end{enumerate}

% теплопроводность
\emptyline
Для определения теплового потока в промежуточных 
узлах сетки $w(x_{i\pm1/2})$, воспользуемся 
закон теплопроводности Фурье \eqref{eq:FourierLaw}, 
из которого следует:
\begin{gather*}
u^{\prime}(x)=-\dfrac{w(x)}{k(x)}
\qquad\Rightarrow\qquad
\intfright{ u^{\prime}(x) }=-\intfright{ \dfrac{w(x)}{k(x)} }.
\end{gather*}

После интегрирования получим:
\begin{gather}\label{eq:ODE+BC:FourierLaw}
u(x_{i+1})-u({x_{i}})=-\intfright{ \dfrac{w(x)}{k(x)} }.
\end{gather}

%
%	Приближенное значение интегралов
%
При построении разностной схемы,
в выражениях \eqref{eq:ODE+BC:heat balance} и 
\eqref{eq:ODE+BC:FourierLaw}
необходимо вычислять определенные интегралы.
Однако, во многих практически важных приложениях 
первообразные подынтегральных функций 
не могут быть выражены в элементарных функциях.
Кроме того, коэффициенты краевой задачи 
могут быть известны только в узлах расчетной сетки
$\{k(x_i), r(x_i), q(x_i)\}$.
В этом случае для вычислений определенных интегралов
необходимо пользоваться 
\alert{численным методом интегрирования}.

Для этого воспользуемся простейшими интерполяциями 
коэффициентов $\vect{f}(x)=\{k(x), r(x), q(x)\}$
(рисунок \ref{fig:ODE+BC:gap-function}), неизвестной функции 
$u(x)$ (температуры) и ее потока $w(x)$ (тепловой поток) 
(рисунок \ref{fig:ODE+BC:u(x) and w(x)}) 
в окрестности узлов $\{x_i\}$ в виде:
\begin{gather}\label{eq:ODE_BC(approx)}
\begin{cases}
w(x)=w(x_{i+1/2}),&x_i \leqslant x \leqslant x_{i+1}\\
\vect{f}(x)=\vect{f}(x_i),&x_i \leqslant x \leqslant x_{i+1}\\
u(x)=u(x_i),&x_{i-1/2} \leqslant x \leqslant x_{i+1/2}\\
\end{cases}.
\end{gather}

Тогда левосторонняя формула прямоугольников совпадает с точным значением интегралов
(рисунок \ref{fig:ODE_BC(Integral)}):
\begin{gather}\label{eq:ODE+BC:integral}
\intf{ x_i }{ x_{i+1} }{ y(x) }\approx
y(x_i)\cdot (x_{i+1}-x_i)=y_i\cdot h_{i+1},
\end{gather}
где $y_{i}=y(x_{i})$ -- значение функции в левом узле $x_{i-1}$ расчётной сетки.

\end{document}

\begin{figure} % *** Приближенное значение интегралов ***
\begin{center}
\input{ODE_BC_fig/ODE_BC_fig(Int).tex}
\caption{Приближенное вычисление значения определенных интегралов
в уравнении баланса тепла \eqref{eq:ODE_BC_CON}}
\label{fig:ODE_BC(Integral)}
\end{center}
\end{figure}

Приближенное значение интеграла в \eqref{eq:ODE_BC(FourierLaw)}
выразим воспользовавшись кусочной аппроксимацией \eqref{eq:ODE_BC(approx)}
теплового потока $w(x)\approx w(x_{i+\onehalf})$ на интервале $(x_{i},x_{i+1})$
и левосторонней формулой прямоугольников 
\eqref{eq:ODE_BC(Integral)}:
\begin{gather}
\begin{array}{rcl}
u(x_{i+1})-u(x_{i})&\approx&-\dfrac{w(x_{i+\onehalf})}{k_{i+1}}\cdot h_{i+1}
\end{array}
,\end{gather}
и найдем поток тепла в промежуточных узлах сетки $w(x_{i+\onehalf})$:
\begin{gather}\label{eq:ODE_BC(w)}
w(x_{i+\onehalf})\approx -{k}_{i+1}\cdot\dfrac{u(x_{i+1})-u(x_{i})}{h_{i+1}}
\end{gather}
где $k_{i+1}=k(x_{i+1})$ -- значение коэффициента 
температуропроводности в узлах расчётной сетки $\{x_{i+1}\}$.

% Конвекционный теплообмен
Приближенное значение интегрального (суммарного) 
конвекционного теплового потока через  
боковую поверхность контрольной области
$[x_{i-\onehalf},x_{i+\onehalf}]$:
\begin{gather*}
\intfCenter{ r(x)\cdot u(x) }\approx u(x_i)\cdot\overline{r}_i
,\end{gather*}
где $\overline{r}_i$ -- интегральный коэффициент конвекционного теплообмена:
\begin{gather*}
\overline{r}_i=\intfCenter{ r(x) }
.\end{gather*}

Для определения интегрального коэффициента конвекционного теплообмена
$\overline{r}_i$ используем кусочную аппроксимацию \eqref{eq:ODE_BC(approx)}, 
а также условие расположения узлов сетки, таких что коэффициент 
$r(x)$ имеет \textit{точки разрыва только в узлах расчётной сетки}:
\begin{gather}\label{eq:ODE_BC(<r>)}
% <r>
\overline{r}_i=\bracketssquare{\hspace{1ex}\intfleft{ r(x) }+\intfright{ r(x) } }
=\dfrac{r_{i}h_i+r_{i+1}h_{i+1}}{2}
,\end{gather}
где $r_i=r(x_i)$ -- коэффициент конвекционного теплообмена
стержня с окружающей средов в узлах сетки $\{x_i\}$.

% Распределенные источники
Суммарное количество тепла $\overline{g}_i$,
выделяемого распределенными источниками
в пределах контрольной области $[x_{i-\onehalf},x_{i+\onehalf}]$,
определяется аналогично:
\begin{gather}\label{eq:ODE_BC(<g>)}
% <g>
\overline{g}_i=\intfCenter{ g(x) }\approx\dfrac{g_{i}h_i+g_{i+1}h_{i+1}}{2}
\end{gather}
где $g_i=g(x_i)$ -- плотность распределенных источников тепла 
в узлах сетки $\{x_i\}$.

Таким образом, баланс тепловой энергии на участке стержня 
$[x_{i-\onehalf}$, $x_{i+\onehalf}]$ с учетом соотношений
для переноса тепла за счет теплопроводности материала стержня
\eqref{eq:ODE_BC(w)}, конвекционного теплообмена с окружающей средой
\eqref{eq:ODE_BC(<r>)} и распределенных источников
\eqref{eq:ODE_BC(<g>)}, можно записать в виде системы разностных уравнений: 
\begin{gather}\label{eq:ODE_BC(FD)}
\left\{\begin{matrix}
w(x_{i+\onehalf}) - w(x_{i-\onehalf}) + \overline{r}_i\cdot u(x_i) = \overline{g}_i
\eqsep
w(x_{i+\onehalf})=-{k}_{i+1}\cdot\dfrac{u(x_{i+1})-u(x_{i})}{h_{i+1}}
\end{matrix}\right.
\end{gather} 
 
\begin{tcolorbox}%[colback=blue!10]
Система уравнений \eqref{eq:ODE_BC(FD)} по своему построению является разностным аналогом 
основного дифференциального уравнения \eqref{eq:ODE_BC0}.
Записывая уравнение \eqref{eq:ODE_BC(FD)} во всех узлах сетки, в которых оно определено
($i=1,2,\dots, N-1$), получим систему из $2N-1$ линейных алгебраических уравнений 
относительно $2N+1$ неизвестных $u(0), u(x_1),\dots, u(x_i),\dots, u(x_{N-1}),u(\ell)$.
Два недостающих уравнения получаются путем \textit{аппроксимации 
краевых условий} \eqref{eq:ODE_BC20}. 
\end{tcolorbox}

%
%	Разностная схема для краевых условий
%
\subsubsection{Разностная аппроксимация краевых условий}
Воспользуемся \textit{интегро-интерноляционным методом} и 
проинтегрируем основное уравнение \eqref{eq:ODE_BC0} 
вблизи левой границы рассматриваемой области $x=0$:
\begin{gather*}
\intf{0}{ x_{1/2} }{ w^{\prime}(x) }
+\intf{0}{ x_{1/2} }{ r(x)u(x) }
=\intf{0}{ x_{1/2} }{ g(x) }
\end{gather*}

Тогда уравнение теплового баланса близи границ области $x=0$ и $x=\ell$:
\begin{gather}\label{eq:ODE_BC(LEFT)}
w(x_{\onehalf})-w(0)+\overline{r}_0u(0)=\overline{g}_0
,\end{gather}
где
$w(x_{\onehalf})$ -- тепловой поток в первом промежуточном узле $x_{\onehalf}$;
$w(0)$ -- тепловой поток на левой границе области;
$\overline{r}_0$ и $\overline{g}_0$ -- интегральный коэффициент
конвекционного теплообмена стержня с окружающей средой 
и количество тепла выделяемое распределенными источникам 
на левой границе $x=0$:
\begin{gather}\label{eq:ODE_BC(r0,g0)}
\overline{r}_0=\intf{0}{ x_{1/2} }{ r(x) }=\dfrac{r_0h_1}{2},
\quad%\eqsep
\overline{g}_0=\intf{0}{ x_{1/2} }{ g(x) }=\dfrac{g_0h_1}{2}.
\end{gather}

Аналогично рассматривая правую границу области $x=\ell$,
уравнение теплового баланса можно записать в виде:
\begin{gather}\label{eq:ODE_BC(RIGHT)}
w(\ell)-w(x_{N-\onehalf})+\overline{r}_N u(\ell)=\overline{g}_N
,\end{gather}
где
$w(\ell)$ -- тепловой поток на правой границе области;
$w(x_{N-\onehalf})$ -- тепловой поток в последнем промежуточном узле $x_{N-\onehalf}$;
$\overline{r}_N$ и $\overline{g}_N$ -- интегральный коэффициент
конвекционного теплообмена стержня с окружающей средой 
и количество тепла выделяемое распределенными источникам 
на левой границе $x=\ell$:
\begin{gather}\label{eq:ODE_BC(rN,gN)}
\overline{r}_{N}=\intf{x_{N-1/2}}{ \ell }{ r(x) }=\dfrac{r_{N}h_N}{2},
\quad%\eqsep
\overline{g}_{N}=\intf{x_{N-1/2}}{ \ell }{ g(x) }=\dfrac{g_{N}h_N}{2}.
\end{gather}

%
%	РАЗНОСТНАЯ СХЕМА
%
Объединяя все разностные соотношения 
для дифференциального уравнения \eqref{eq:ODE_BC(FD)} 
и граничных условий \eqref{eq:ODE_BC20}, \eqref{eq:ODE_BC(LEFT)}, \eqref{eq:ODE_BC(RIGHT)}
получаем следующую разностную схему 
для граничной задачи \eqref{eq:ODE_BC0}, \eqref{eq:ODE_BC20}:
\begin{tcolorbox}
\begin{gather}\label{eq:ODE_BC(LIN_SYS)}
\left\{\begin{matrix}
w(x_{\onehalf})+\brackets{ \overline{r}_0+\lambda_1}u(0)=\overline{g}_0 + \mu_1
\eqsep
w(x_{i+\onehalf}) - w(x_{i-\onehalf}) + \overline{r}_i\cdot u(x_i) = \overline{g}_i
\eqsep
w(x_{i+\onehalf})=-{k}_{i+1}\cdot\dfrac{u(x_{i+1})-u(x_{i})}{h_{i+1}}
\eqsep
-w(x_{N-\onehalf})+\brackets{ \overline{r}_N+\lambda_2}u(\ell)=\overline{g}_N + \mu_2
\end{matrix}\right.
.\end{gather}
\end{tcolorbox}

\subsection{Метод решения систем линейных уравнений с матрицами специального вида}

Если исходной задачей является краевая задача для 
обыкновенного дифференциального уравнения, 
то соответствующую разностную схему можно решить с помощью метода прогонки.

В многомерном случае не существует столь же удобного 
и экономичного способа решения разностных уравнений, как метод 
прогонки. Поэтому возникает необходимость в развитии методов, 
специально предназначенных для решения многомерных разностных 
краевых задач. Мы будем рассматривать здесь лишь двумерные 
разностные задачи. 
Как и в общем случае систем линейных уравнений, 
методы решения разностных задач разделяются на прямые и итерационные. 
Итерационные методы являются более простыми, чем прямые, и в 
меньшей степени используют структуру матрицы. 
По этой причине для решения двумерных разностных уравнений 
первоначально использовались исключительно итерационные методы. 
Однако в случае разностных задач сходимость таких, например, методов, как 
метод простой итерации, Зейделя, верхней релаксации, 
весьма медленная. 
В настоящее время интенсивно развиваются и 
прямые методы решения двумерных разностных уравнений. 
Они применимы, как правило, к уравнениям с разделяющимися 
переменными, когда область изменения независимых переменных 
является прямоугольник. 

% *************************************************************
%
%	МЕТОД ПРОГОНКИ
%
% *************************************************************
\subsubsection{Метод прогонки для трехточечных уравнений}
Система уравнений \eqref{eq:ODE_BC_FD} представляет собой 
частный случай систем линейных алгебраических уравнений:
\begin{gather*}
\vec{A}\cdot\vec{u}=\vec{f}
\end{gather*}
с трехдиагональной матрицей $\vec{А}$, т.е. с матрицей, 
все элементы которой, не лежащие на главной и двух побочных диагоналях, равны нулю.
\begin{gather}\label{eq:ODE_BC_SYS}
\begin{pmatrix}
-c_0&b_0&0&\dots&\dots&\dots&0\\
a_1&-c_1&b_1&0&\dots&\dots&0\\
0&a_2&-c_2&b_2&0&\cdots&0\\
\dots&\dots&\dots&\dots&\dots&\dots&\dots\\
0&\dots&0&a_{N-2}&-c_{N-2}&b_{N-2}&0\\
0&\dots&\dots&0&a_{N-1}&-c_{N-1}&b_{N-1}\\
0&\dots&\dots&\dots&0&a_N&-c_N\\
\end{pmatrix}
\cdot
\begin{pmatrix}
u_0\\u_1\\u_2\\ \cdots\\u_{N-2}\\u_{N-1}\\u_{N}
\end{pmatrix}
=
\begin{pmatrix}
f_0\\f_1\\f_2\\ \cdots\\f_{N-2}\\f_{N-1}\\f_{N}
\end{pmatrix}
,\end{gather}
где $u_i=u(x_i)$ -- значение неизвестной функции в узлах сетки.

В общем случае системы линейных алгебраических уравнений 
с трехдиагональной матрицей имеют вид:
\begin{gather}\label{eq:ODE_BC_SOL}
a_i\cdot u_{i-1} - c_i\cdot u_{i} + b_i\cdot u_{i+1} = -f_i,\quad i=1,2,\dots,N-1
\end{gather}

Для численного решения систем с трехдиагональными матрицами 
применяется \textit{метод прогонки}, который представляет 
собой вариант метода последовательного исключения неизвестных.

Особенно широкое применение метод прогонки получил при решении 
систем разностных уравнений, возникающих при аппроксимации 
краевых задач для дифференциальных уравнений второго порядка.

Решение системы линейных уравнений \eqref{eq:ODE_BC_SOL}
будем искать в виде:
\begin{gather}\label{eq:ODE_ALPHA}
u_i=\alpha_{i+1}\cdot u_{i+1} + \beta_{i+1}
,\end{gather}
где $\alpha_{i+1}$ и $\beta_{i+1}$ -- неизвестные коэффициенты, 
которые необходимо определить.

Пользуясь уравнением \eqref{eq:ODE_ALPHA} и выражая $u_{i-1}$ получим:
\begin{gather}\label{eq:ODE_ALPHA2}
u_{i-1}=\alpha_{i}\cdot u_{i} + \beta_{i}=
\alpha_{i}~\alpha_{i+1}\cdot u_{i+1}+(\alpha_{i}~\beta_{i+1} + \beta_{i})
.\end{gather}

Подставляя соотношения для $u_{i-1}$ \eqref{eq:ODE_ALPHA2}
и $u_{i}$ \eqref{eq:ODE_ALPHA} в выражение \eqref{eq:ODE_BC_SOL} получим:
\begin{gather*}
a_i\cdot(\alpha_{i}~\alpha_{i+1}\cdot u_{i+1}+(\alpha_{i}~\beta_{i+1} + \beta_{i}))
-c_i\cdot(\alpha_{i+1}\cdot u_{i+1} + \beta_{i+1})
+b_i\cdot u_{i+1} = -f_i
\end{gather*}

Это уравнение будет выполнено для всех $i=1,2,\dots,N-1$, 
если потребовать равенство нулю всех коэффициентов 
при неизвестных $u_{i+1}$ и свободных членов:
\begin{gather*}
\begin{cases}
(a_i\cdot\alpha_{i}-c_i)\cdot\alpha_{i+1}=-b_i\\
(a_i\cdot\alpha_{i}-c_i)\cdot\beta_{i+1}=-(a_i\cdot\beta_i+f_i)
\end{cases}
\end{gather*}

Из последнего выражения получаем рекуррентные соотношения 
для определения значений неизвестных коэффициентов
$\alpha_{i+1}$ и $\beta_{i+1}$:
\begin{gather}\label{eq:ODE_ALPHA_BETA}
\alpha_{i+1}=\dfrac{b_i}{c_i-a_i\cdot\alpha_{i}},\quad
\beta_{i+1}=\dfrac{a_i\cdot\beta_i+f_i}{c_i-a_i\cdot\alpha_{i}}
\end{gather}

Соотношения \eqref{eq:ODE_ALPHA_BETA} представляют собой 
нелинейные разностные уравнения первого порядка.
Для их решения необходимо задать начальные значения 
$\alpha_1$ и $\beta_1$.
Эти начальные значения находим из краевого условия на левой
границе рассматриваемой области $x=0$:
\begin{gather*}
\begin{cases}
-c_0\cdot u_0+b_0\cdot u_1 = -f_0\\
u_0=\alpha_{1}\cdot u_{1} + \beta_{1}
\end{cases}
\quad\text{или}\quad
\begin{cases}
u_0=\dfrac{b_0}{c_0}\cdot u_1+\dfrac{f_0}{c_0}\\
u_0=\alpha_{1}\cdot u_{1} + \beta_{1}
\end{cases}
.\end{gather*}

Сопоставляя выражение для $u_0$ получим:
\begin{gather}\label{eq:ODE_ALPHA1_BETA1}
\alpha_{1}=\dfrac{b_0}{c_0},\quad \beta_{1}=\dfrac{f_0}{c_0}
\end{gather}

Нахождение коэффициентов $\alpha_{i+1}$ и $\beta_{i+1}$ 
по рекуррентным соотношениям 
\eqref{eq:ODE_ALPHA_BETA} и \eqref{eq:ODE_ALPHA1_BETA1}
называется \textit{прямой прогонкой}.
После того как прогоночные коэффициенты $\alpha_{i+1}$ и $\beta_{i+1}$
($i=1,2,\dots,N-1$), найдены, решение системы \eqref{eq:ODE_BC_SYS} 
находится по рекуррентному соотношению \eqref{eq:ODE_ALPHA},
если известно значение функции $u_N$ на правой границе области.
Неизвестное значение функции $u_N$ можно определить 
из краевого условия на правой границе области $x=\ell$:
\begin{gather}\label{eq:ODE_SYS_uN}
\begin{cases}
a_N\cdot u_{N-1}-c_N\cdot u_N = -f_N\\
u_{N-1}=\alpha_{N}\cdot u_{N} + \beta_{N}
\end{cases}
.\end{gather}

Из решения системы уравнений \eqref{eq:ODE_SYS_uN} 
определяется значение неизвестной функции $u_N$
на правой границе:
\begin{gather}\label{eq:ODE_uN}
u_N=\dfrac{a_N\cdot\beta_N+f_N}{c_N-a_N\cdot\alpha_N}
\end{gather}

Последовательное нахождение значений 
неизвестной функции $u(x)$ в узлах сетки 
по рекуррентному соотношению \eqref{eq:ODE_ALPHA}
называется \textit{обратной прогонкой}.


% *************************************************************
%
%	МЕТОД ПОТОКОВОЙ ПРОГОНКИ
%
% *************************************************************
\subsubsection{Потоковый вариант метода прогонки}
Потоковый вариант метода прогонки применяется при решении задач 
с сильно меняющимися коэффициентами в выражениях для потоков
неизвестных величин (элактрического заряда, количества тепла, количества жидкости и т.д.).
Например, в задачах гидродинамики с теплопроводностью и магнитной гидродинамики, 
коэффициенты теплопроводности и электропроводности могут сильно зависят 
от термодинамических параметров среды.
В случае тепловых задач в пределах рассматриваемых областей 
могут иметь место адиабатические участки, где теплопроводность отсутствует, а также 
изотермические участки с бесконечно высоким коэффициентом теплопроводности.
В задачах магнитной гидродинамики могут рассматриваться области 
с идеально проводящими и изолирующими участками.

Часто в таких задачах, помимо неизвестной функции (решения задачи), 
требуется найти еще и ее поток (например, электричества, тепла, жидкости и т.д.).
При решении разностных уравнений второго порядка, 
к которым сводятся разностные схемы для этих задач, 
с помощью метода обычной прогонки часто происходит значительная потеря точности. 
Последующее использование численного дифференцирования для вычисления потока 
приводит к неудовлетворительному результату. 
Избавиться от этого недостатка удается путем перехода к так называемому 
потоковому варианту метода прогонки. 

Предположим наличие между искомой функцией $u$ и ее потоком $w$ связи вида:
\begin{gather*}
\alpha\cdot u + \beta\cdot w = \gamma
\end{gather*}

Так как коэффициенты $\alpha$, $\beta$ и $\gamma$ определены с точностью 
до множителя, то на функции $\alpha$ и $\beta$ необходимо наложить дополнительное условие,
в зависимости от типа краевой задачи, характера коэффициента и т.д.
Например, иногда удобно считать $\alpha=1$ либо $\beta=1$
или полагать:
\begin{gather*}
\alpha + \beta\cdot C(x) = 1
,\end{gather*}
где $C(x)>0$ -- некоторая функция.
 
Будем искать решение системы уравнений \eqref{eq:ODE_BC(LIN_SYS)} в том же виде, 
в котором заданы краевые условия:
\begin{gather}
u(x_i) = \alpha_i\cdot w(x_{i+\onehalf}) + \beta_i
,\end{gather}
где $\alpha_i$ и $\beta_i$ -- неизвестные коэффициенты.
 
 




% **************************************************
%
%	Таблица коэффициентов системы разностных уравнений
%
\begin{table}[h]
\caption{
Выражения для коэффициентов системы разностных уравнений \eqref{eq:ODE_BC_FD}
краевой задачи \eqref{eq:ODE_BC0}, \eqref{eq:ODE_BC20}
}
\label{tab:ODE_BC_FD}
\begin{tabular}{p{1cm} p{5cm} p{6cm} p{3cm}}
\toprule
$i$&0&$1,2,3,\dots,N-1$&$N$\\
\midmidrule
$h_i$&&$(x_i-x_{i-1})$&$(x_{N}-x_{N-1})$\\
\midrule
% k
$\overline{k}_i$&&$\dfrac{2k_{i}k_{i-1}}{k_{i}+k_{i-1}}$&\\[1em]
% q
$\tilde{v}_i$&$v_0\cdot\dfrac{h_1}{2}$&$v_i\cdot\overline{h_i}$&\\[1em]
% f
$\tilde{g}_i$&$g_0\cdot\dfrac{h_1}{2}$&$g_i\cdot\overline{h_i}$&\\
\midrule
$a_i$&&$\dfrac{\overline{k}_i}{h_i}$&0\\[1em]
$b_i$&$a_1$&$a_{i+1}$&\\[1em]
$c_i$
&$a_1+\tilde{v}_0-\lambda_1$
&$(a_i+b_i)+\tilde{v}_i$
&1\\[1em]
%f
$f_i$
&$\tilde{g}_0+\mu_1$
&$\tilde{g}_i$
&$\mu_2$\\
\bottomrule
\end{tabular}
\end{table}
% **************************************
%
%	Разностная схема в МАТРИЧНОЙ ФОРМЕ
%
Запишем разностную схему в матричной форме:
\begin{gather}\label{eq:ODE_BC_FD}
\left\{\begin{array}{lclclcll}
&-&c_0\cdot u(0)&+&b_0\cdot u(x_{1})&=&-f_0\\
a_{1}\cdot u(0)&-&c_{1}\cdot u(x_{1})&+&b_{1}\cdot u(x_{2})&=&-f_{1}\\
\vdots&&\vdots&&\vdots&&\vdots\\
a_{i}\cdot u(x_{i-1})&-&c_{i}\cdot u(x_{i})&+&b_{i}\cdot u(x_{i+1})&=&-f_{i}\\
\vdots&&\vdots&&\vdots&&\vdots\\
a_{N-1}\cdot u(x_{N-2})&-&c_{N-1}\cdot u(x_{N-1})&+&b_{N-1}\cdot u(\ell)&=&-f_{N-1}\\
a_{N}\cdot u(x_{N-1})&-&c_N\cdot u(\ell)&&&=&-f_N
\end{array}\right.
,\end{gather}
где $a$, $c$, $b$ и $f$ -- коэффициенты при незвестных ${u(x_i)}$ 
и правая часть системы линейных уравнений, 
выражения для которых сведены в таблицу \eqref{tab:ODE_BC_FD}:


\begin{tcolorbox}
Алгоритм метода прогонки:
\begin{enumerate}
\item
Составить однородную разностную схему 
для решения исходной краевой задачи методом баланса 
(интегро-интерполяционным методом)
\item
На неравномерной сетке определить шаг $h_i$ сетки для каждого 
элементарного отрезка $[x_{i-1},x_{i}]$
\item
Вычислить все коэффициенты разностной схемы 
$\overline{k}_i$, $\overline{q}_i$, $\overline{f}_i$
краевой задачи во всех узлах сетки $\{x_i\}$ $(i=0,1,2,\dots,N)$
\item
Определить коэффициенты линейной системы уравнений
$a_i$, $b_i$, $c_i$ и $f_i$ $(i=0,1,2,\dots,N)$
полученной разностной схемы.
\item
Найти решение полученной системы линейных алгебраических уравнений
$\{u_i\}$ методом прогонки:
\begin{enumerate}[label=(\roman*)]
\item
Из краевого условия на левой границе области $x=0$
вычислить коэффициенты \eqref{eq:ODE_ALPHA1_BETA1}:
\begin{gather*}
\alpha_{1}=\dfrac{b_0}{c_0},\quad \beta_{1}=\dfrac{f_0}{c_0}
\end{gather*}
\item
Пользуясь рекуррентными соотношениями \eqref{eq:ODE_ALPHA_BETA},
определить значения неизвестных коэффициентов для $i=2,3,\dots,N-1$:
\begin{gather*}
\alpha_{i+1}=\dfrac{b_i}{c_i-a_i\cdot\alpha_{i}},\quad
\beta_{i+1}=\dfrac{a_i\cdot\beta_i+f_i}{c_i-a_i\cdot\alpha_{i}}
\end{gather*}
\item
Из краевого условия на правой границе области $x=\ell$ определить
значение неизвестной функции $u_N$ из соотношения \eqref{eq:ODE_uN}:
\begin{gather*}
u_N=\dfrac{a_N\cdot\beta_N+f_N}{c_N-a_N\cdot\alpha_N}
\end{gather*}
\item
Определить значения неизвестной функции в узлах сетки
пользуясь рекуррентными соотношениями \eqref{eq:ODE_ALPHA}:
\begin{gather*}
u_i=\alpha_{i+1}\cdot u_{i+1} + \beta_{i+1}
\end{gather*}
\end{enumerate}
\end{enumerate}
\end{tcolorbox}

%
%	ЧИСЛЕННОЕ РЕШЕНИЕ краевой задачи методом прогонки
%
\subsection{Численное решение краевой задачи методом прогонки}
Рассмотрим краевую задачу на отрезке $x\in[0,7]$:
\begin{gather*}
\left((3+\sin(x))\cdot u^{\prime}(x)\right)^{\prime}-|\cos(x)|\cdot u(x) + 0.5\cdot (x-1)^2=0\\
\left\{\begin{matrix}
u(0)=2\\
-k(7)\cdot u^{\prime}(7)+0,5\cdot u(7)=17,24
\end{matrix}\right.
\end{gather*}

Из данных краевой задачи можно заключить, что коэффициенты 
в дифференциальном уравнении являются функциями вида:
\begin{gather*}
k(x)=3+\sin(x),\quad q(x)=|\cos(x)|,\quad f(x)=0.5\cdot (x-1)^2
\end{gather*}

Для построения разностной схемы для решения краевой задачи,
воспользуемся интегро-интерполяционным методом (методом баланса).
\begin{enumerate}
\item
Разностный аналог дифференциального уравнения краевой задачи
получаем аналогично \eqref{eq:ODE_BC_CON2}:
\begin{gather*}
-\overline{k}_{i+1}\cdot\dfrac{u(x_{i+1})-u(x_{i})}{h_{i+1}}
+\overline{k}_i\cdot\dfrac{u(x_{i})-u(x_{i-1})}{h_i}
+\overline{q}_i\cdot\dfrac{h_{i+1}+h_i}{2}\cdot u(x_i)
=\overline{f}_i\cdot\dfrac{h_{i+1}+h_i}{2}% h_{i+\onehalf}
\end{gather*} 
\item
На левой границе области $x=0$ граничное условие имеет вид:
\begin{gather}\label{eq:ODE_BC_LEFT_MY}
u(0)=2
\end{gather}
\item
Вблизи правой границы на отрезке $x\in[x_{N-\onehalf},\ell]$
воспользуемся \textit{интегро-интерноляционным методом} и 
проинтегрируем основное уравнение \eqref{eq:ODE_BC0} задачи:
\begin{gather*}
\int\limits_{x_{N-\onehalf}}^{\ell}w^{\prime}(x)dx
+\int\limits_{x_{N-\onehalf}}^{\ell}q(x)\cdot u(x)dx
=\int\limits_{x_{N-\onehalf}}^{\ell}f(x)dx
,\end{gather*}
где $w(x)=-k(x)\cdot u^{\prime}(x)$ -- поток неизвестной функции $u(x)$.

Предположим, что в пределах отрезка $[x_{N-\onehalf},\ell]$ 
неизвестная функция $u(x)$ остается постоянной $u(x)\approx u(\ell)$
(рисунок \ref{fig:ODE_BC_RIGHT_SOL}),
тогда краевое условие на правой границе запишется в виде:
\begin{gather}\label{eq:ODE_BC_RIGHT_SOL}
w(\ell)-w({x_{N-\onehalf}})
+u(\ell)\cdot\int\limits_{x_{N-\onehalf}}^{\ell}q(x)dx
=\int\limits_{x_{N-\onehalf}}^{\ell}f(x)dx
,\end{gather}
где $w({x_{N-\onehalf}})$ -- потоковая величина 
в последнем промежуточном узле $x_{N-\onehalf}$
определяется из соотношения:
\begin{gather*}
u^{\prime}(x)=-\dfrac{w(x)}{k(x)}\quad \Rightarrow \quad
\int\limits_{x_{N-1}}^{\ell}u^{\prime}(x)dx
=-\int\limits_{x_{N-1}}^{\ell}\dfrac{w(x)}{k(x)}dx
\end{gather*}

Предполагая, что тепловой поток $w(x)$ постоянен в пределах области
$[x_{N-1},\ell]$, т.е. $w(x)\approx w(x_{N-\onehalf})$, определим
изменение неизвестной функции $u(x)$ в этой области:
\begin{gather*}
u(\ell)-u(x_{N-1})=-w(x_{N-\onehalf})\cdot\int\limits_{x_{N-1}}^{\ell}\dfrac{dx}{k(x)}
\end{gather*}

Для вычисление определенного интеграла в последнем выражении
воспользуемся формулой трапеций:
\begin{gather*}
\int\limits_{x_{N-1}}^{\ell}\dfrac{dx}{k(x)}
\approx\dfrac{h_N}{2}\cdot\brackets{ \dfrac{1}{k_{N-1}}+\dfrac{1}{k_{N}} }  
\end{gather*}

%
%	ПРАВАЯ ГРАНИЦА
%
\begin{figure}
\begin{center}
\begin{tikzpicture}[background rectangle/.style={fill=olive!10}, show background rectangle]
\def\ul{7.5}
\def\xl{9.5}
\def\xxl{4}
\def\uul{2	}
\def\xxxl{0.5}
\def\uuul{5}
\begin{axis}
[
%	axis on top=true,
	every axis/.style={color=black, solid, thick},
	ytick pos=right,			% ось OY - справа
	ylabel = {\empty},	% подпись оси y
	xmin=0, xmax=10, xtick={\xxxl,(\xxxl+\xxl)/2,\xxl,(\xxl+\xl)/2,\xl}, xticklabels={$x_{N-2}$,$x_{N-\frac{3}{2}}$,$x_{N-1}$,$x_{N-1/2}$,$\ell$},
	ymin=0, ymax=10, ytick={\uuul,\uul,\ul}, yticklabels={$u(x_{N-2})$,$u(x_{N-1})$,$u(\ell)$},
	xtick style={thick, black},
	ytick style={thick, black},
	grid=major,		
	major grid style={color=black!20, dashed, thin},
]
\addplot[fill=black!10, draw=none] coordinates {(\xl,0) (\xl,10) ((\xl+\xxl)/2,10) ((\xl+\xxl)/2,0)}\closedcycle;
\addplot[only marks, mark=*, mark size=5pt, 
mark options={fill=lime, draw=black, solid},
const plot mark mid,
very thick,
]
coordinates {(\xxxl,\uuul) (\xxl,\uul) (\xl,\ul)};
\draw[-] (axis cs:{(\xl+\xxl)/2},0) -- (axis cs:\xl,0) node[midway,above] {$\dfrac{h_N}{2}$};
\end{axis}
\end{tikzpicture}
\caption{
Схематическое изображение распределения неизвестной функции $u(x)$
вблизи правой границы $x=\ell$
}
\label{fig:ODE_BC_RIGHT_SOL}
\end{center}
\end{figure}
%*******************************************

Следовательно, потоковая величина в последнем промежуточном узле 
определяется выражением:
\begin{gather}\label{eq:ODE_BC_RIGHT2}
w({x_{N-\onehalf}})=-\overline{k}_N\cdot\dfrac{u(\ell)-u(x_{N-1})}{h_N}
,\end{gather}
где $\overline{k}_N$ -- среднее значение коэффициента $k(x)$ на отрезке
$[x_{N-1},\ell]$:
\begin{gather*}
\overline{k}_N=\dfrac{2k_{N}k_{N-1}}{k_{N}+k_{N-1}}
\end{gather*}

Из общего вида второго краевого условия
\begin{gather*}
-k(\ell)\cdot u^{\prime}(\ell)+\lambda_2\cdot u(\ell)=\mu_2
\end{gather*}
выразим величину потока на границе рассматриваемой области $w(\ell)$:
\begin{gather}\label{eq:ODE_BC_RIGHT3}
w(\ell)=-k(\ell)\cdot u^{\prime}(\ell) = \mu_2-\lambda_2\cdot u(\ell)
\end{gather}

Для вычислений определенных интегралов в
\eqref{eq:ODE_BC_RIGHT_SOL}
воспользуемся формулой прямоугольников:
\begin{gather}\label{eq:ODE_BC_RIGHT4}
\int\limits_{x_{N-\onehalf}}^{\ell}q(x)dx\approx q_N\cdot\dfrac{h_N}{2},\quad
\int\limits_{x_{N-\onehalf}}^{\ell}f(x)dx\approx f_N\cdot\dfrac{h_N}{2}
.\end{gather}

С учетом соотношений \eqref{eq:ODE_BC_RIGHT2}, 
\eqref{eq:ODE_BC_RIGHT3}, \eqref{eq:ODE_BC_RIGHT4}
уравнение баланса вблизи правой границе \eqref{eq:ODE_BC_RIGHT_SOL} 
запишется в разностном виде:
\begin{gather}\label{eq:ODE_BC_RIGHT_MY}
\mu_2-\lambda_2\cdot u(\ell)
+\overline{k}_N\cdot\dfrac{u(\ell)-u(x_{N-1})}{h_N}
+u(\ell)\cdot\brackets{q_N\cdot\dfrac{h_N}{2}}
=f_N\cdot\dfrac{h_N}{2}
.\end{gather}

Объединяя все полученные разностные соотношения 
для дифференциального уравнения
и граничных условий \eqref{eq:ODE_BC_LEFT_MY}, \eqref{eq:ODE_BC_RIGHT_MY}
получаем следующую разностную схему:
\begin{tcolorbox}[colback=blue!5]
\begin{gather*}
\left\{\begin{array}{rcl}
% x=0
u(0)&=&\mu_1\\[1em]
% уравнение
-\overline{k}_{i+1}\cdot\dfrac{u(x_{i+1})-u(x_{i})}{h_{i+1}}
+\overline{k}_i\cdot\dfrac{u(x_{i})-u(x_{i-1})}{h_i}
+\overline{q}_i\cdot h_{i\pm\onehalf}\cdot u(x_i)
&=&\overline{f}_i\cdot h_{i\pm\onehalf}\\[1em]
% x=l
\mu_2-\lambda_2\cdot u(\ell)
+\overline{k}_N\cdot\dfrac{u(\ell)-u(x_{N-1})}{h_N}
+u(\ell)\cdot\brackets{q_N\cdot\dfrac{h_N}{2}}
&=&f_N\cdot\dfrac{h_N}{2}
\end{array}\right.
.\end{gather*}
\end{tcolorbox}
\item
На отрезке введем произвольную сетку $\{x_i\}$ 
и определим шаг сетки $h_i$:
\vspace{1em}

\begin{tabular}{p{1cm} *{10}{p{1cm}}}
\toprule
$i$&0&1&2&3&4&5&6&7&8&9\\
\midmidrule
$x_i$&0&1&2&3&4&4.75&5&5.5&6&7\\
\midrule
$h_i$&&1&1&1&1&0.75&0.25&0.5&0.5&1\\
\bottomrule
\end{tabular}
\vspace{1em}

\item
Вычислим средние значения коэффициентов 
разностной схемы краевой задачи
во всех узлах сетки $\{x_i\}$ $(i=0,1,2,\dots,N)$:
\vspace{1em}

\begin{tabular}{p{1cm} *{10}{p{1cm}}}
\toprule
$i$&0&1&2&3&4&5&6&7&8&9\\
\midmidrule
$\overline{k}_i$&&3.37&3.88&3.48&2.62&2.12&2.02&2.16&2.49&3.12\\
$\overline{q}_i$&1.00&0.54&0.42&0.99&0.65&0.04&0.28&0.71&0.96&0.75\\
$\overline{f}_i$&0.50&0.00&0.50&2.00&4.50&7.03&8.00&10.13&12.50&18.00\\
\bottomrule
\end{tabular}
\vspace{1em}

\item
Определим коэффициенты линейной системы уравнений
$a_i$, $b_i$, $c_i$ и $f_i$\\$(i=0,1,2,\dots,N)$
полученной разностной схемы:



\end{enumerate}


\end{document}
