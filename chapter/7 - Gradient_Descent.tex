%
%	ПРЕАМБУЛА
%
\input{../../preamble}
\begin{document}

% колонтитулы
\newpage
\pagestyle{fancy}
\renewcommand{\headrulewidth}{0.5pt}
\lhead{Метод градиентного спуска}
\rhead{\arabic{page}}
\lfoot{\empty}
\cfoot{\empty}
\rfoot{\empty}
\setcounter{page}{1}

\textbf{Введение}

Градиентный спуск -- метод нахождения локального экстремума (минимума или максимума) функции 
с помощью движения вдоль градиента этой функции. 
Это наиболее простой в реализации из всех методов локальной оптимизации, но имеет
относительно малую (линейную) скорость сходимости.

Градиент это вектор, указывающий направление наибольшего возрастания некоторой величины $\varphi$, значение которой меняется от одной точки пространства к другой (скалярного поля), а по величине (модулю) равный скорости роста этой величины в этом направлении.
Компонентами вектора градиента являются частные производные 
$\varphi$ по всем её аргументам.

Для случая трёхмерного пространства градиентом скалярной функции 
$\varphi=\varphi(x,y,z)$ координат называется векторная функция:
\begin{gather*}
\rm grad(\varphi)=\vec\nabla\varphi
,\end{gather*}
где $\vec\nabla$ -- векторный дифференциальный оператор набла,
компоненты которого являются частными производными по координатам:
\begin{gather*}
\vec\nabla=\left(\pdiff{}{x}, \pdiff{}{y}, \pdiff{}{z}\right)
\end{gather*}

Следует отметить, что оператор набла не принадлежит тому же пространству, 
что и обычные векторы, а говоря точнее, скалярное и векторное произведение 
для него определено с некоторыми отличиями. Оператор $\nabla$ действует на те поля, 
что стоят от него справа, и не действует на стоящие от него слева.
Поэтому скалярное и векторное произведение с участием $\nabla$ \textit{не коммутативны}
и не антикоммутативны, как это свойственно для таких произведений обычных векторов.

Если для целевой функции многих переменных $S(x_1,x_2,\cdots,x_n)$ 
поставлена задача оптимизации следующим образом:
\begin{gather*}
S(x_1,x_2,\cdots,x_n)\to\min
\end{gather*}

Основная идея метода градиентного спуска заключается в том, 
чтобы последовательно идти в направлении наискорейшего спуска, 
а это направление задаётся антиградиентом $-\vec\nabla{S}$.
Например, для двухмерного случая:
\begin{gather*}
\begin{matrix}
x^{(i+1)}&=&x^{(i)} - \lambda_x^{(i)}\cdot\nabla_{x}S(x^{(i)},y^{(i)})\\
y^{(i+1)}&=&y^{(i)} - \lambda_y^{(i)}\cdot\nabla_{y}S(x^{(i)},y^{(i)})\\
\end{matrix}
,\end{gather*}
где $i$ -- номер итерационного шага процесса;
$\nabla_{x}$ и $\nabla_{y}$ -- компоненты вектора градиента в декартовой системы координат (на плоскости);
$\lambda_x$ и $\lambda_y$ -- скорость градиентного спуска в направлении оси $OX$ и $OY$, соответственно.

\textbf{Алгоритм метода градиентного спуска}
\begin{enumerate}[leftmargin = 1ex]
\item 
Задают начальное приближение ${(x^0,y^0)}$, 
скорость градиентного спуска $\lambda_x$ и $\lambda_y$, 
а также точность расчёта $\varepsilon$.
\item
Рассчитывают градиент целевой функции в текущей точке ${\nabla^{(0)}=\nabla S(x^0,y^0)}$.
\item
Определяют новую точку в соответствии с соотношением:
\begin{gather*}
\begin{matrix}
x^{(1)}&=&x^{(0)} - \lambda_x^{(0)}\cdot\nabla_{x}^{(0)}\\
y^{(1)}&=&y^{(0)} - \lambda_y^{(0)}\cdot\nabla_{y}^{(0)}\\
\end{matrix} 
\end{gather*}
\item
Рассчитывают величину расстояния между двумя точками:
\begin{gather*}
r=\sqrt{\left[x^{(0)}-x^{(1)}\right]^2+\left[y^{(0)}-y^{(1)}\right]^2}
\end{gather*}
\item
Проверяют условие остановки:
если $r<\varepsilon$, то итерационный процесс останавливается;
иначе текущую точку считают начальной ${x^{(0)}=x^{(1)}}$ и ${y^{(0)}=y^{(1)}}$
и переходят к шагу (2) итерационного процесса.
\end{enumerate}

%
%	Пример
%
\newpage
%\setcounter{page}{1}
\renewcommand{\footrulewidth}{0.5pt}
\lfoot{Поиск оптимального положения склада}

Известны географические координаты трех городов: 
\href{https://ru.wikipedia.org/wiki/\%D0\%9D\%D0\%B8\%D0\%BF\%D0\%BF\%D1\%83\%D1\%80}{Ниппур}$(4;2)$,
\href{https://ru.wikipedia.org/wiki/\%D0\%AD\%D1\%80\%D0\%B8\%D0\%B4\%D1\%83}{Эриду}$(1;7)$
\href{https://ru.wikipedia.org/wiki/\%D0\%A8\%D1\%83\%D1\%80\%D1\%83\%D0\%BF\%D0\%BF\%D0\%B0\%D0\%BA}{Шуруппак}$(8;4)$.
% *******************************
%	График функций
%
\begin{center}
\begin{tikzpicture}
\begin{axis}[
	every axis/.style={color=black, solid, thick},
	xlabel = {широта ($x$)},	% подпись оси x
	ylabel = {долгота ($y$)},	% подпись оси y
	xmin = 0, ymin = 0,
	xmax = 10, ymax = 10,	
	xtick style={thick, black},
	ytick style={thick, black},
	grid=major,		
	major grid style={color=black!20, dashed, thin},
]
\addplot[only marks, mark=square*, mark size=5pt, mark options={fill=yellow, draw=black, solid}]
coordinates {(4,2) (1,7) (8,4)};
\draw[color=black] (axis cs: 4,2.5) node {Ниппур};
\draw[color=black] (axis cs: 1,7.5) node {Эриду};
\draw[color=black] (axis cs: 8,4.5) node {Шуруппак};
% Склад
\addplot[only marks, mark=*, mark size=4pt, mark options={fill=red!75, draw=black, solid}]
coordinates {(5,9)};
\draw[color=red] (axis cs: 7,9) node {Склад$(x_0,y_0)$};
\draw[color=orange] (axis cs: 5,9) -- (axis cs: 4,2) node [midway, xshift=1.5ex, color=red] {$R_1$};
\draw[color=orange] (axis cs: 5,9) -- (axis cs: 1,7) node [midway, yshift=-2ex, color=red] {$R_2$};
\draw[color=orange] (axis cs: 5,9) -- (axis cs: 8,4) node [midway, xshift=2ex, color=red] {$R_3$};
\end{axis}
\end{tikzpicture}
\end{center}
% *******************************

\begin{enumerate}[leftmargin = 1ex]
\item
Обозначим неизвестные:\\
$x_0$ -- географическая широта положения склада;\\
$y_0$ -- географическая долгота положения склада.
\item
Целевая функция -- суммарное расстояние от склада до всех магазинов:
\begin{gather*}
S=R_1 + R_2 + R_3
,\end{gather*}
где $R_1$ -- расстояние от \textcolor{red}{Склада} до города \hl{Ниппур};
$R_2$ -- расстояние от Склада до города \hl{Эриду};
$R_3$ -- расстояние от Склада до города \hl{Шуруппак};
\item
Поверхность планеты \href{https://earth.google.com/web/}{Земля} 
будем считать ``плоской`` в пределах области поиска положения Склада.
Поэтому для нахождения расстояния от склада до каждого города воспользуемся теоремой 
\href{https://ru.wikipedia.org/wiki/\%D0\%9F\%D0\%B8\%D1\%84\%D0\%B0\%D0\%B3\%D0\%BE\%D1\%80}{Пифагора Самосского}:
\begin{gather*}
R_1=\sqrt{(x_1-x_0)^2+(y_1-y_0)^2}\\
R_2=\sqrt{(x_2-x_0)^2+(y_2-y_0)^2}\\
R_3=\sqrt{(x_3-x_0)^2+(y_3-y_0)^2}
,\end{gather*}
где 
$x_1$ и $y_1$ -- географическая широта и долгота города Ниппур;
$x_2$ и $y_2$ -- географическая широта и долгота города Эриду;
$x_3$ и $y_3$ -- географическая широта и долгота города Шуруппак.

Таким образом, целевая функция -- суммарное расстояние от склада до всех городов, 
с учетом данных задания о географических координатах городов (Ниппур, Эриду и Шуруппак),
запишется в виде:
\begin{gather*}
\begin{matrix}
S(x_0,y_0)=
&&&\sqrt{(4-x_0)^2+(2-y_0)^2}&+\\
&&+&\sqrt{(1-x_0)^2+(7-y_0)^2}&+\\
&&+&\sqrt{(8-x_0)^2+(4-y_0)^2}&
\end{matrix}
\end{gather*}

\item
Определим градиент целевой функции $\nabla S$:
\begin{gather*}
\nabla S~\left(\pdiff{S}{x_0},~\pdiff{S}{y_0}\right)
\end{gather*}
Для этого найдем частные производные целевой функции от широты ($x_0$) и долготы ($y_0$) положения склада:
\begin{gather*}
\begin{matrix}
\pdiff{S}{x_0}=
&&-&\dfrac{4-x_0}{\sqrt{(4-x_0)^2+(2-y_0)^2}}&-\\[1em]
&&-&\dfrac{1-x_0}{\sqrt{(1-x_0)^2+(7-y_0)^2}}&-\\[1em]
&&-&\dfrac{8-x_0}{\sqrt{(8-x_0)^2+(4-y_0)^2}}&\\
\end{matrix}
\end{gather*}
\begin{gather*}
\begin{matrix}
\pdiff{S}{y_0}=
&&-&\dfrac{2-y_0}{\sqrt{(4-x_0)^2+(2-y_0)^2}}&-\\[1em]
&&-&\dfrac{7-y_0}{\sqrt{(1-x_0)^2+(7-y_0)^2}}&-\\[1em]
&&-&\dfrac{4-y_0}{\sqrt{(8-x_0)^2+(4-y_0)^2}}&\\
\end{matrix}
\end{gather*}

\item
Выбираем (в общем случае, произвольно) начальные координаты склада, 
например, $x_0=5$ и $y_0=9$.\\
Будем пологать, что скорость градиентного спуска по широте и долготе одинакова, т.е.
$\lambda_{x_0}=\lambda_{y_0}=2$.\\
Задаем точность расчёта $\varepsilon=0,25$ (единиц измерения).

\item
Текущее суммарное расстояние от склада до всех городов:
\begin{gather*}
\begin{matrix}
S(5; 9)=
&&&\sqrt{(4-5)^2+(2-9)^2}&+&\\
&&+&\sqrt{(1-5)^2+(7-9)^2}&+&\\
&&+&\sqrt{(8-5)^2+(4-9)^2}&=&17,37
\end{matrix}
\end{gather*}

Рассчитаем градиент целевой функции в исходной точке положения склада $\nabla^{(0)} S(5; 9)$:
\begin{gather*}
\begin{matrix}
\nabla^{(0)}_{x_0}{S}(5;9)=
&&-&\dfrac{4-5}{\sqrt{(4-5)^2+(2-9)^2}}&-\\[1em]
&&-&\dfrac{1-5}{\sqrt{(1-5)^2+(7-9)^2}}&-\\[1em]
&&-&\dfrac{8-5}{\sqrt{(8-5)^2+(4-9)^2}}&=0,52\\
\end{matrix}
\end{gather*}
\begin{gather*}
\begin{matrix}
\nabla^{(0)}_{y_0}{S}(5;9)=
&&-&\dfrac{2-9}{\sqrt{(4-5)^2+(2-9)^2}}&-\\[1em]
&&-&\dfrac{7-9}{\sqrt{(1-5)^2+(7-9)^2}}&-\\[1em]
&&-&\dfrac{4-9}{\sqrt{(8-5)^2+(4-9)^2}}&=2,29\\
\end{matrix}
\end{gather*}

Зная градиент целевой функции в исходной точке $\nabla^{(0)}=(0,52; 2,29)$,
определяем новое географическое положение склада:
\begin{gather*}
\begin{matrix}
x_0^{(1)}&=&x_0^{(0)} - \lambda_x^{(0)}\cdot\nabla_{x}^{(0)}&=5-2\cdot0,52=3,96\\
y_0^{(1)}&=&y_0^{(0)} - \lambda_y^{(0)}\cdot\nabla_{y}^{(0)}&=9-2\cdot2,29=4,41\\
\end{matrix} 
\end{gather*}

\hl{Новые географические координаты склада} $(x_0=3,96; y_0=4,41)$.
% *******************************
%	График функций
%
\begin{center}
\begin{tikzpicture}
\begin{axis}[
	every axis/.style={color=black, solid, thick},
	xlabel = {широта ($x$)},	% подпись оси x
	ylabel = {долгота ($y$)},	% подпись оси y
	xmin = 0, ymin = 0,
	xmax = 10, ymax = 10,	
	xtick style={thick, black},
	ytick style={thick, black},
	grid=major,		
	major grid style={color=black!20, dashed, thin},
]
\addplot[only marks, mark=square*, mark size=5pt, mark options={fill=yellow, draw=black, solid}]
coordinates {(4,2) (1,7) (8,4)};
\draw[color=black] (axis cs: 4,2.5) node {Ниппур};
\draw[color=black] (axis cs: 1,7.5) node {Эриду};
\draw[color=black] (axis cs: 8,4.5) node {Шуруппак};
% Склад
\addplot[color=red, mark=*, mark size=4pt, mark options={fill=red!75, draw=black, solid}]
coordinates {(5,9) (3.96,4.41)};
\draw[color=red] (axis cs: 5,4.4) node {Склад};
\end{axis}
\end{tikzpicture}
\end{center}
% *******************************
Рассчитаем величину ``шага`` -- расстояния между двумя последовательными положениями склада:
\begin{gather*}
r=\sqrt{(5-3,96)^2+(9-4,41)^2}=4,71
\end{gather*}

Сравниваем величину текущего ``шага`` $r$ и заданную точность расчетов $\varepsilon$:
\begin{gather*}
r=4,71>0,25=\varepsilon
\end{gather*}
Величина текущего ``шага`` $r$ больше заданной точности расчетов $\varepsilon$,
следовательно, \hl{итерационный процесс продолжаем}!

\item
Текущее суммарное расстояние от склада до всех городов:
\begin{gather*}
\begin{matrix}
S(3,96; 4,41)=
&&&\sqrt{(4-3,96)^2+(2-4,41)^2}&+&\\
&&+&\sqrt{(1-3,96)^2+(7-4,41)^2}&+&\\
&&+&\sqrt{(8-3,96)^2+(4-4,41)^2}&=&10,41
\end{matrix}
\end{gather*}

Рассчитаем градиент целевой функции в новой точке положения склада\\
$\nabla^{(1)} S(3,96;4,41)$:
\begin{gather*}
\begin{matrix}
\nabla^{(1)}_{x_0}{S}(3,96;4,41)=
&&-&\dfrac{4-3,96}{\sqrt{(4-3,96)^2+(2-4,41)^2}}&-\\[1em]
&&-&\dfrac{1-3,96}{\sqrt{(1-3,96)^2+(7-4,41)^2}}&-\\[1em]
&&-&\dfrac{8-3,96}{\sqrt{(8-3,96)^2+(4-4,41)^2}}&=-0,26\\
\end{matrix}
\end{gather*}
\begin{gather*}
\begin{matrix}
\nabla^{(1)}_{y_0}{S}(3,96;4,41)=
&&-&\dfrac{2-4,41}{\sqrt{(4-3,96)^2+(2-4,41)^2}}&-\\[1em]
&&-&\dfrac{7-4,41}{\sqrt{(1-3,96)^2+(7-4,41)^2}}&-\\[1em]
&&-&\dfrac{4-4,41}{\sqrt{(8-3,96)^2+(4-4,41)^2}}&=0,44\\
\end{matrix}
\end{gather*}

Зная градиент целевой функции в текущей точке $\nabla^{(1)}=(-0,26; 0,44)$,
определяют новое географическое положение склада:
\begin{gather*}
\begin{matrix}
x_0^{(2)}&=&x_0^{(1)} - \lambda_x^{(1)}\cdot\nabla_{x}^{(1)}&=3,96-2\cdot(-0,26)=4,48\\
y_0^{(2)}&=&y_0^{(1)} - \lambda_y^{(1)}\cdot\nabla_{y}^{(1)}&=4,41-2\cdot0,44=3,53\\
\end{matrix} 
\end{gather*}

\hl{Новые географические координаты склада} $(x_0=4,48; y_0=3,53)$.
% *******************************
%	График функций
%
\begin{center}
\begin{tikzpicture}
\begin{axis}[
	every axis/.style={color=black, solid, thick},
	xlabel = {широта ($x$)},	% подпись оси x
	ylabel = {долгота ($y$)},	% подпись оси y
	xmin = 0, ymin = 0,
	xmax = 10, ymax = 10,	
	xtick style={thick, black},
	ytick style={thick, black},
	grid=major,		
	major grid style={color=black!20, dashed, thin},
]
\addplot[only marks, mark=square*, mark size=5pt, mark options={fill=yellow, draw=black, solid}]
coordinates {(4,2) (1,7) (8,4)};
\draw[color=black] (axis cs: 4,2.5) node {Ниппур};
\draw[color=black] (axis cs: 1,7.5) node {Эриду};
\draw[color=black] (axis cs: 8,4.5) node {Шуруппак};
% Склад
\addplot[color=red, mark=*, mark size=4pt, mark options={fill=red!75, draw=black, solid}]
coordinates {(5,9) (3.96,4.41) (4.48,3.53)};
\draw[color=red] (axis cs: 5.7,3.5) node {Склад};
\end{axis}
\end{tikzpicture}
\end{center}
% *******************************
Рассчитаем величину ``шага`` -- расстояния между двумя последовательными положениями склада:
\begin{gather*}
r=\sqrt{(3,96-4,48)^2+(4,41-3,53)^2}=1,03
\end{gather*}

Сравниваем величину текущего ``шага`` $r$ и заданную точность расчетов $\varepsilon$:
\begin{gather*}
r=1,03>0,25=\varepsilon
\end{gather*}
Величина текущего ``шага`` $r$ больше заданной точности расчетов $\varepsilon$,
следовательно, \hl{итерационный процесс продолжаем}!

\item
Текущее суммарное расстояние от склада до всех городов:
\begin{gather*}
\begin{matrix}
S(4,48; 3,53)=
&&&\sqrt{(4-4,48)^2+(2-3,53)^2}&+&\\
&&+&\sqrt{(1-4,48)^2+(7-3,53)^2}&+&\\
&&+&\sqrt{(8-4,48)^2+(4-3,53)^2}&=&10,07
\end{matrix}
\end{gather*}

Рассчитаем градиент целевой функции в новой точке положения склада\\
$\nabla^{(2)} S(4,48;3,53)$:
\begin{gather*}
\begin{matrix}
\nabla^{(2)}_{x_0}{S}(4,48;3,53)=
&&-&\dfrac{4-4,48}{\sqrt{(4-4,48)^2+(2-3,53)^2}}&-\\[1em]
&&-&\dfrac{1-4,48}{\sqrt{(1-4,48)^2+(7-3,53)^2}}&-\\[1em]
&&-&\dfrac{8-4,48}{\sqrt{(8-4,48)^2+(4-3,53)^2}}&=0,02\\
\end{matrix}
\end{gather*}
\begin{gather*}
\begin{matrix}
\nabla^{(2)}_{y_0}{S}(4,48;3,53)=
&&-&\dfrac{2-3,53}{\sqrt{(4-4,48)^2+(2-3,53)^2}}&-\\[1em]
&&-&\dfrac{7-3,53}{\sqrt{(1-4,48)^2+(7-3,53)^2}}&-\\[1em]
&&-&\dfrac{4-3,53}{\sqrt{(8-4,48)^2+(4-3,53)^2}}&=0,11\\
\end{matrix}
\end{gather*}

Зная градиент целевой функции в текущей точке $\nabla^{(2)}=(0,02; 0,11)$,
определяют новое географическое положение склада:
\begin{gather*}
\begin{matrix}
x_0^{(3)}&=&x_0^{(2)} - \lambda_x^{(2)}\cdot\nabla_{x}^{(2)}&=4,48-2\cdot0,02=4,45\\
y_0^{(3)}&=&y_0^{(2)} - \lambda_y^{(2)}\cdot\nabla_{y}^{(2)}&=3,53-2\cdot0,11=3,30\\
\end{matrix} 
\end{gather*}

\hl{Новые географические координаты склада} $(x_0=4,45; y_0=3,30)$.
% *******************************
%	График функций
%
\begin{center}
\begin{tikzpicture}
\begin{axis}[
	every axis/.style={color=black, solid, thick},
	xlabel = {широта ($x$)},	% подпись оси x
	ylabel = {долгота ($y$)},	% подпись оси y
	xmin = 0, ymin = 0,
	xmax = 10, ymax = 10,	
	xtick style={thick, black},
	ytick style={thick, black},
	grid=major,		
	major grid style={color=black!20, dashed, thin},
]
\addplot[only marks, mark=square*, mark size=5pt, mark options={fill=yellow, draw=black, solid}]
coordinates {(4,2) (1,7) (8,4)};
\draw[color=black] (axis cs: 4,2.5) node {Ниппур};
\draw[color=black] (axis cs: 1,7.5) node {Эриду};
\draw[color=black] (axis cs: 8,4.5) node {Шуруппак};
% Склад
\addplot[color=red, mark=*, mark size=4pt, mark options={fill=red!75, draw=black, solid}]
coordinates {(5,9) (3.96,4.41) (4.48,3.53) (4.45,3.30)};
\draw[color=red] (axis cs: 5.5,3.2) node {Склад};
\end{axis}
\end{tikzpicture}
\end{center}
% *******************************
Рассчитаем величину ``шага`` -- расстояния между двумя последовательными положениями склада:
\begin{gather*}
r=\sqrt{(4,48-4,45)^2+(3,53-3,30)^2}=0,23
\end{gather*}

Сравниваем величину текущего ``шага`` $r$ и заданную точность расчетов $\varepsilon$:
\begin{gather*}
r=0,23<0,25=\varepsilon
\end{gather*}
Величина текущего ``шага`` $r$ меньше заданной точности расчетов $\varepsilon$,
поэтому итерационный \hl{процесс} поиска положения склада \hl{останавливаем}.

\item
Определим минимальное расстояние от склада до всех городов:
\begin{gather*}
\begin{matrix}
S(4,45; 3,30)=
&&&\sqrt{(4-4,45)^2+(2-3,30)^2}&+&\\
&&+&\sqrt{(1-4,45)^2+(7-3,30)^2}&+&\\
&&+&\sqrt{(8-4,45)^2+(4-3,30)^2}&=&10,05
\end{matrix}
\end{gather*}
\end{enumerate}

Таким образом, с заданной точностью определены оптимальные 
координаты склада $(x_{opt}=4,45; y_{opt}=3,30)$, 
при которых общее расстояние от всех городов до склада 
будет минимальным и составит $S_{min}=10,05$:

\end{document}
